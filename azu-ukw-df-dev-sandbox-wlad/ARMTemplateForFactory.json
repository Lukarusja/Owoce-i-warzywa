{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "azu-ukw-df-dev-sandbox-wlad"
		},
		"ls_csdb_dev_wlad_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ls_csdb_dev_wlad'"
		},
		"ls_file_dev_split_wlad_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ls_file_dev_split_wlad'",
			"defaultValue": "DefaultEndpointsProtocol=https;AccountName=@{linkedService().StorageAccountName};EndpointSuffix=core.windows.net;"
		},
		"ls_file_dev_wlad_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ls_file_dev_wlad'"
		},
		"ls_sf_dev_split_wlad_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ls_sf_dev_split_wlad'",
			"defaultValue": "jdbc:snowflake://@{linkedService().AccountName}.snowflakecomputing.com/?user=@{linkedService().Username}&db=@{linkedService().Database}&warehouse=@{linkedService().Warehouse}&role=@{linkedService().Role}"
		},
		"ls_sf_dev_wlad_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ls_sf_dev_wlad'"
		},
		"ls_sftp_dev_split_wlad_passPhrase": {
			"type": "secureString",
			"metadata": "Secure string for 'passPhrase' of 'ls_sftp_dev_split_wlad'"
		},
		"ls_sftp_dev_wlad_privateKeyContent": {
			"type": "secureString",
			"metadata": "Secure string for 'privateKeyContent' of 'ls_sftp_dev_wlad'"
		},
		"ls_sftp_dev_wlad_passPhrase": {
			"type": "secureString",
			"metadata": "Secure string for 'passPhrase' of 'ls_sftp_dev_wlad'"
		},
		"ls_sqls_wlad_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ls_sqls_wlad'"
		},
		"kv_dev_wlad_properties_typeProperties_baseUrl": {
			"type": "string",
			"defaultValue": "https://azu-ukw-kv-dev-wlad.vault.azure.net/"
		},
		"ls_blob_dev_split_wlad_properties_typeProperties_sasUri_secretName": {
			"type": "string",
			"defaultValue": "@linkedService().KVSasUrl"
		},
		"ls_blob_dev_wlad_sasUri": {
			"type": "secureString",
			"metadata": "Secure string for 'sasUri' of 'ls_blob_dev_wlad'"
		},
		"ls_sftp_dev_split_wlad_properties_typeProperties_host": {
			"type": "string",
			"defaultValue": "@{linkedService().Hostname}"
		},
		"ls_sftp_dev_split_wlad_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "@{linkedService().Username}"
		},
		"ls_sftp_dev_wlad_properties_typeProperties_host": {
			"type": "string",
			"defaultValue": "sftp.zynchub4.co.uk"
		},
		"ls_sftp_dev_wlad_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "@{linkedService().Username}"
		},
		"ls_table_dev_wlad_sasUri": {
			"type": "secureString",
			"metadata": "Secure string for 'sasUri' of 'ls_table_dev_wlad'"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/API Management KH Test')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "JsonSink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings"
								},
								"formatSettings": {
									"type": "JsonWriteSettings"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "SourceBlobCSV",
								"type": "DatasetReference",
								"parameters": {
									"FileName": "Heinz Select API Outlets List 20240202_pipesall.csv"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DiffRG_TargetFileJSON",
								"type": "DatasetReference",
								"parameters": {
									"DatawareHouseName": "test",
									"FileName": "outputFull.json",
									"StorageAccountName": "azuukssadevedgewellwlad",
									"FileShare": "stfs-sandbox-dev-wlad",
									"KVStorageAccKey": "sa-access-key-edgewell-new"
								}
							}
						]
					},
					{
						"name": "Copy data2",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Copy data1",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"sink": {
								"type": "CosmosDbSqlApiSink",
								"writeBehavior": "insert"
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "DiffRG_TargetFileJSON",
								"type": "DatasetReference",
								"parameters": {
									"DatawareHouseName": "test",
									"FileName": "outputFull.json",
									"StorageAccountName": "azuukssadevedgewellwlad",
									"FileShare": "stfs-sandbox-dev-wlad",
									"KVStorageAccKey": "sa-access-key-edgewell-new"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "KraftHeinzAPI_CSDB_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-02-05T15:42:15Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceBlobCSV')]",
				"[concat(variables('factoryId'), '/datasets/DiffRG_TargetFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/KraftHeinzAPI_CSDB_Dataset')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG ETL Create Logs')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "set elt_uuid",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "elt_uuid",
							"value": {
								"value": "@if(\n  or(\n    empty(coalesce(pipeline().parameters.uuid,'')),\n    less(length(pipeline().parameters.uuid),32)\n  ),\n  guid('N'),\n  pipeline().parameters.uuid\n)\n\n",
								"type": "Expression"
							}
						}
					},
					{
						"name": "If uuid is empty",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "set elt_uuid",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@or(\nempty(coalesce(pipeline().parameters.uuid,'')),\nless(length(pipeline().parameters.uuid),32)\n)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "Update ingestion",
									"type": "Script",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "ls_sf_dev_split_wlad",
										"type": "LinkedServiceReference",
										"parameters": {
											"AccountName": {
												"value": "@json(pipeline().parameters.cfg).datastore.account",
												"type": "Expression"
											},
											"Username": {
												"value": "@json(pipeline().parameters.cfg).datastore.username",
												"type": "Expression"
											},
											"Database": {
												"value": "@json(pipeline().parameters.cfg).datastore.database",
												"type": "Expression"
											},
											"Warehouse": {
												"value": "@json(pipeline().parameters.cfg).datastore.warehouse",
												"type": "Expression"
											},
											"Password": {
												"value": "@json(pipeline().parameters.cfg).datastore.password_kv",
												"type": "Expression"
											},
											"Role": {
												"value": "@json(pipeline().parameters.cfg).datastore.role",
												"type": "Expression"
											}
										}
									},
									"typeProperties": {
										"scripts": [
											{
												"parameters": [
													{
														"name": "source_size",
														"type": "Int32",
														"value": "0",
														"direction": "Input"
													},
													{
														"name": "rowsRead",
														"type": "Int16",
														"value": {
															"value": "@pipeline().parameters.rows_read",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "128"
													},
													{
														"name": "rowsCopied",
														"type": "Int16",
														"value": {
															"value": "@pipeline().parameters.rows_copied",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "first_error",
														"type": "String",
														"value": "No",
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "errors_seen",
														"type": "Int16",
														"value": {
															"value": "@pipeline().parameters.errors_seen",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "status",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.status",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "512"
													},
													{
														"name": "elt_uuid",
														"type": "String",
														"value": {
															"value": "@variables('elt_uuid')",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													}
												],
												"type": "NonQuery",
												"text": "update APP.INGESTION set \n  source_size = ?,\n  rows_parsed = ?,\n  rows_loaded = ?,\n  first_error = ?,\n  errors_seen = ?,\n  status = ?\nwhere uuid = to_binary(?,'hex')"
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "Create ingestion",
									"type": "Script",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "ls_sf_dev_split_wlad",
										"type": "LinkedServiceReference",
										"parameters": {
											"AccountName": {
												"value": "@json(pipeline().parameters.cfg).datastore.account",
												"type": "Expression"
											},
											"Username": {
												"value": "@json(pipeline().parameters.cfg).datastore.username",
												"type": "Expression"
											},
											"Database": {
												"value": "@json(pipeline().parameters.cfg).datastore.database",
												"type": "Expression"
											},
											"Warehouse": {
												"value": "@json(pipeline().parameters.cfg).datastore.warehouse",
												"type": "Expression"
											},
											"Password": {
												"value": "@json(pipeline().parameters.cfg).datastore.password_kv",
												"type": "Expression"
											},
											"Role": {
												"value": "@json(pipeline().parameters.cfg).datastore.role",
												"type": "Expression"
											}
										}
									},
									"typeProperties": {
										"scripts": [
											{
												"parameters": [
													{
														"name": "elt_uuid",
														"type": "String",
														"value": {
															"value": "@variables('elt_uuid')",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "local_file",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.local_file",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "128"
													},
													{
														"name": "blob_file",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.blob_file",
															"type": "Expression"
														},
														"direction": "Input"
													},
													{
														"name": "tenant_code",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.tenant_code",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "datasource_code",
														"type": "String",
														"value": {
															"value": "@coalesce(\n    pipeline().parameters.datasource,\n    pipeline().parameters.tenant_code\n)",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "dest_schema",
														"type": "String",
														"value": {
															"value": "@coalesce(\n    pipeline().parameters.dest_schema,\n    json(variables('cfg')).datastore.schema\n)",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "dest_table",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.dest_table",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "remarks",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.remarks",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "512"
													},
													{
														"name": "attr",
														"type": "String",
														"value": {
															"value": "@string(pipeline().parameters.attr)",
															"type": "Expression"
														},
														"direction": "Input"
													},
													{
														"name": "run_id",
														"type": "String",
														"value": {
															"value": "@pipeline()?.TriggeredByPipelineRunId",
															"type": "Expression"
														},
														"direction": "Input"
													},
													{
														"name": "pipeline_name",
														"type": "String",
														"value": {
															"value": "@pipeline()?.TriggeredByPipelineName",
															"type": "Expression"
														},
														"direction": "Input"
													}
												],
												"type": "NonQuery",
												"text": "insert into app.INGESTION (uuid, start_time, status, username, host, local_file, blob_file, tenant_code, datasource_code, dest_schema, dest_table, remarks, attr)\n  select to_binary(?,'hex'),\n  current_timestamp,'INIT','ADF','-',\n  ?,\n  ?,\n  ?,\n  ?,\n  ?,\n  ?,\n  ?, \nobject_insert(object_insert(coalesce(try_parse_json(?),object_construct()), 'ADF.TriggeredByPipelineRunId',?),'ADF.TriggeredByPipelineName',?)"
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Set output",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "If uuid is empty",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "uuid",
									"value": {
										"type": "Expression",
										"content": "@variables('elt_uuid')"
									}
								}
							],
							"setSystemVariable": true
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"blob_file": {
						"type": "string"
					},
					"local_file": {
						"type": "string"
					},
					"tenant_code": {
						"type": "string"
					},
					"slot": {
						"type": "string",
						"defaultValue": "prod"
					},
					"datasource": {
						"type": "string"
					},
					"uuid": {
						"type": "string"
					},
					"dest_table": {
						"type": "string"
					},
					"dest_schema": {
						"type": "string"
					},
					"attr": {
						"type": "string"
					},
					"sf_copy_stats": {
						"type": "array",
						"defaultValue": []
					},
					"sf_copy_output": {
						"type": "object"
					},
					"remarks": {
						"type": "string"
					},
					"status": {
						"type": "string"
					},
					"rows_read": {
						"type": "string"
					},
					"rows_copied": {
						"type": "string"
					},
					"errors_seen": {
						"type": "string"
					},
					"cfg": {
						"type": "string"
					}
				},
				"variables": {
					"elt_uuid": {
						"type": "String",
						"defaultValue": "00000000000000000000000000000000"
					},
					"subscription_id": {
						"type": "String",
						"defaultValue": "6a4c5e4b-460f-458a-8296-f42254574265"
					},
					"app_config": {
						"type": "Array",
						"defaultValue": []
					},
					"cfg": {
						"type": "String",
						"defaultValue": "{}"
					},
					"fileinfo": {
						"type": "Array",
						"defaultValue": []
					},
					"sf_copy_stats": {
						"type": "Array",
						"defaultValue": []
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-23T18:41:22Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sf_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG ETL Generic Copy JSON')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": "Import/InProcess",
									"wildcardFileName": {
										"value": "@pipeline().parameters.Filename",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "DiffRG_FileMover",
								"type": "DatasetReference",
								"parameters": {
									"InOrOut": "InProcess",
									"StorageAccountName": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DiffRG_FileMover",
								"type": "DatasetReference",
								"parameters": {
									"InOrOut": "Processed",
									"StorageAccountName": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					},
					{
						"name": "Create Initial Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"dest_schema": "INGESTION",
								"attr": "{}",
								"status": "Loading",
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Generic Generate Column Mapping Two Step",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.Filename",
									"type": "Expression"
								},
								"StorageAccountName": {
									"value": "@json(pipeline().parameters.cfg).storageaccount.name",
									"type": "Expression"
								},
								"FileShare": {
									"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
									"type": "Expression"
								},
								"KVStorageAccKey": {
									"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Copy data from Source to Ingest",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Create Initial Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": "Import/InProcess",
									"wildcardFileName": {
										"value": "@pipeline().parameters.Filename",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"sink": {
								"type": "SnowflakeSink",
								"importSettings": {
									"type": "SnowflakeImportCopyCommand"
								}
							},
							"enableStaging": true,
							"stagingSettings": {
								"linkedServiceName": {
									"referenceName": "ls_blob_dev_split_wlad",
									"type": "LinkedServiceReference",
									"parameters": {
										"KVSasUrl": {
											"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
											"type": "Expression"
										}
									}
								},
								"path": "stagingjson"
							},
							"translator": {
								"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "DiffRG_SourceFileJSON",
								"type": "DatasetReference",
								"parameters": {
									"StorageAccountName": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DiffRG_TargetTable",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@if(startswith(pipeline().parameters.Filename, 'tactical'),json(pipeline().parameters.cfg).datastore.tablename_tactical , json(pipeline().parameters.cfg).datastore.tablename_reports )",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@json(pipeline().parameters.cfg).datastore.schema",
										"type": "Expression"
									},
									"DatawarehouseName": {
										"value": "@json(pipeline().parameters.cfg).datastore.database",
										"type": "Expression"
									},
									"AccountName": {
										"value": "@json(pipeline().parameters.cfg).datastore.account",
										"type": "Expression"
									},
									"Username": {
										"value": "@json(pipeline().parameters.cfg).datastore.username",
										"type": "Expression"
									},
									"Database": {
										"value": "@json(pipeline().parameters.cfg).datastore.database",
										"type": "Expression"
									},
									"Warehouse": {
										"value": "@json(pipeline().parameters.cfg).datastore.warehouse",
										"type": "Expression"
									},
									"Password": {
										"value": "@json(pipeline().parameters.cfg).datastore.password_kv",
										"type": "Expression"
									},
									"Role": {
										"value": "@json(pipeline().parameters.cfg).datastore.role",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Update Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy data from Source to Ingest",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"uuid": {
									"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
									"type": "Expression"
								},
								"dest_table": {
									"value": "@if(startswith(pipeline().parameters.Filename, 'tactical'),json(pipeline().parameters.cfg).datastore.tablename_tactical , json(pipeline().parameters.cfg).datastore.tablename_reports )",
									"type": "Expression"
								},
								"dest_schema": "INGESTION",
								"attr": "{}",
								"status": "OK",
								"rows_read": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
									"type": "Expression"
								},
								"rows_copied": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
									"type": "Expression"
								},
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Update Log Fail",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy data from Source to Ingest",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"uuid": {
									"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
									"type": "Expression"
								},
								"dest_table": {
									"value": "@if(startswith(pipeline().parameters.Filename, 'tactical'),json(pipeline().parameters.cfg).datastore.tablename_tactical , json(pipeline().parameters.cfg).datastore.tablename_reports )",
									"type": "Expression"
								},
								"dest_schema": {
									"value": "@json(pipeline().parameters.cfg).datastore.schema",
									"type": "Expression"
								},
								"attr": "{}",
								"status": "FAILED",
								"rows_read": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
									"type": "Expression"
								},
								"rows_copied": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
									"type": "Expression"
								},
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Copy Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Update Log Fail",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "567",
							"errorCode": "Failed to copy data from Source to Ingest"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"Filename": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					},
					"cfg": {
						"type": "string"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					},
					"cfg_sftp": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-24T10:24:10Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DiffRG_FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/DiffRG ETL Create Logs')]",
				"[concat(variables('factoryId'), '/pipelines/DiffRG ETL Generic Generate Column Mapping Two Step')]",
				"[concat(variables('factoryId'), '/datasets/DiffRG_SourceFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/DiffRG_TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG ETL Generic Extract JSON Two Step')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Set Variable Cfg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DiffRG_FileMover",
								"type": "DatasetReference",
								"parameters": {
									"InOrOut": "InProcess",
									"StorageAccountName": {
										"value": "@json(variables('cfg')).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(variables('cfg')).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(variables('cfg')).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@equals(item().type,'File')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ForEach File",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Filter Filename').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"activities": [
								{
									"name": "Execute Pipeline Copy JSON",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"policy": {
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "DiffRG ETL Generic Copy JSON",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"DataWarehouseName": {
												"value": "@pipeline().parameters.DataWarehouseName",
												"type": "Expression"
											},
											"Filename": {
												"value": "@item().name",
												"type": "Expression"
											},
											"Slot": {
												"value": "@pipeline().parameters.Slot",
												"type": "Expression"
											},
											"cfg": {
												"value": "@variables('cfg')",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "Set Variable Cfg",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Get Cfg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "cfg",
							"value": {
								"value": "@activity('Get Cfg').output.value",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Get Cfg",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"method": "GET",
							"headers": {},
							"url": {
								"value": "@concat('https://az-ukw-ac-dev-wlad.azconfig.io/kv/', pipeline().parameters.DataWarehouseName, '_', pipeline().parameters.Slot)",
								"type": "Expression"
							},
							"authentication": {
								"type": "MSI",
								"resource": "https://az-ukw-ac-dev-wlad.azconfig.io"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					},
					"cfg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-23T17:53:48Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DiffRG_FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/DiffRG ETL Generic Copy JSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG ETL Generic Generate Column Mapping Two Step')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Failed To Connect",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account",
							"errorCode": "555"
						}
					},
					{
						"name": "Lookup JSON",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": "Import/InProcess",
									"wildcardFileName": {
										"value": "@pipeline().parameters.FilenamePattern",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DiffRG_SourceFileJSON",
								"type": "DatasetReference",
								"parameters": {
									"StorageAccountName": {
										"value": "@pipeline().parameters.StorageAccountName",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@pipeline().parameters.FileShare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@pipeline().parameters.KVStorageAccKey",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "If File Exists",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@bool(contains(activity('Lookup JSON').output, 'firstRow'))",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "File Not Found",
									"type": "Fail",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"message": "File Not Found",
										"errorCode": "554"
									}
								}
							]
						}
					},
					{
						"name": "Convert JSON_Properties String to Array",
						"description": "Contains an array of properties in JSON returned by the previous step",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties",
							"value": {
								"value": "@split(variables('Helper_String'), '^')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Until",
						"type": "Until",
						"dependsOn": [
							{
								"activity": "Set Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(variables('Current_Property'), sub(variables('Number_of_JSON_Properties'), 1))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Append Column Mapping String",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Column Mapping String Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column_Mapping_String",
										"value": {
											"value": "@variables('Column Mapping String Helper')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Column Mapping String Helper",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column Mapping String Helper",
										"value": {
											"value": "@concat(variables('Column_Mapping_String'),'{\"source\": {\"name\": \"', variables('JSON_Properties')[variables('Current_Property')], '\"},\"target\":{\"name\":\"', replace(replace(replace(replace(variables('JSON_Properties')[variables('Current_Property')], ' ', '_'), '.', ''), '!', ''), '?', ''), '\"}},')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property Helper",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Append Column Mapping String",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property_Helper",
										"value": {
											"value": "@add(variables('Current_Property'),2)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Current Property Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property",
										"value": {
											"value": "@variables('Current_Property_Helper')",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.12:00:00"
						}
					},
					{
						"name": "Set Number of JSON Properties",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Number_of_JSON_Properties",
							"value": {
								"value": "@length(variables('JSON_Properties'))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Set Current_Property",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Current_Property",
							"value": 0
						}
					},
					{
						"name": "Set Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set Current_Property",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Set Number of JSON Properties",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": "{\n  \"type\": \"TabularTranslator\",\n  \"mappings\": ["
						}
					},
					{
						"name": "Clean Up Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Until",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column Mapping String Helper",
							"value": {
								"value": "@substring(variables('Column_Mapping_String'), 0, sub(length(variables('Column_Mapping_String')), 1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Finalize Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "ColumnMappingString",
									"value": {
										"type": "Expression",
										"content": "@concat(variables('Column Mapping String Helper'), ']}')"
									}
								}
							],
							"setSystemVariable": true
						}
					},
					{
						"name": "Set JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "If File Exists",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties_String",
							"value": {
								"value": "@string(activity('Lookup JSON').output.firstRow)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Clean Up JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Helper_String",
							"value": {
								"value": "@replace(replace(replace(replace(replace(replace(replace(replace(replace(variables('JSON_Properties_String'), ',\"', '^'),'/', ''), '\":', '^'), '\"', ''), ' ,', '---'), ',', ','), '---', ' ,'), '{', ''), '}', '')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"StorageAccountName": {
						"type": "string"
					},
					"FileShare": {
						"type": "string"
					},
					"KVStorageAccKey": {
						"type": "string"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-22T18:37:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DiffRG_SourceFileJSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG ETL Generic JSON Cleanup')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Set Column Mapping RAW_TACTICAL_EDGEWELL_TRIMMED",
											"description": "Set Column Mapping for RAW_TACTICAL_EDGEWELL_TRIMMED",
											"type": "SetVariable",
											"dependsOn": [
												{
													"activity": "Script2",
													"dependencyConditions": [
														"Skipped"
													]
												}
											],
											"policy": {
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"variableName": "Column_Mapping_String",
												"value": "{\n\t\"type\": \"TabularTranslator\",\n\t\"mappings\": [\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"date\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"date\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_description\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_description\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_code\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_code\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_ean\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_ean\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"client\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"client\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sub_call\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sub_call\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"retailer\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"retailer\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"store_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"store_id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"store_description\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"store_description\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_date\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"call_date\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t}\n\t\t}\n\t]\n}"
											}
										},
										{
											"name": "Set Column Mapping TRIMMED_QUESTIONS",
											"description": "Set Column Mapping for RAW_TACTICAL_EDGEWELL_TRIMMED_QUESTIONS",
											"type": "SetVariable",
											"dependsOn": [
												{
													"activity": "Set Column Mapping RAW_TACTICAL_EDGEWELL_TRIMMED",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"variableName": "Column Mapping String Helper",
												"value": "{\n\t\"type\": \"TabularTranslator\",\n\t\"mappings\": [\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"question\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"question\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"response\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"response\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"additional_info\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"additional_info\"\n\t\t\t}\n\t\t}\n\t]\n}"
											}
										},
										{
											"name": "Copy TRIMMED",
											"type": "Copy",
											"dependsOn": [
												{
													"activity": "Set Column Mapping RAW_TACTICAL_EDGEWELL_TRIMMED",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SnowflakeSource",
													"query": "SELECT ID,DATE,SKU_ID ,SKU_DESCRIPTION ,SKU_CODE ,SKU_EAN ,CLIENT,SUB_CALL ,RETAILER,STORE_ID ,STORE_DESCRIPTION ,CALL_DATE,CALL_ID FROM INGEST.RAW_TACTICAL_EDGEWELL",
													"exportSettings": {
														"type": "SnowflakeExportCopyCommand"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													}
												},
												"translator": {
													"value": "@variables('Column_Mapping_String')",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL_TRIMMED",
														"SchemaName": "INGEST"
													}
												}
											]
										},
										{
											"name": "Copy TRIMMED_QUESTIONS",
											"type": "Copy",
											"dependsOn": [
												{
													"activity": "Set Column Mapping TRIMMED_QUESTIONS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SnowflakeSource",
													"query": "SELECT CALL_ID, QUESTION, RESPONSE, ADDITIONAL_INFO FROM INGEST.RAW_TACTICAL_EDGEWELL",
													"exportSettings": {
														"type": "SnowflakeExportCopyCommand"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													}
												},
												"translator": {
													"value": "@variables('Column Mapping String Helper')",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL_TRIMMED_QUESTIONS",
														"SchemaName": "INGEST"
													}
												}
											]
										},
										{
											"name": "Script1",
											"type": "Script",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"linkedServiceName": {
												"referenceName": "ls_sf_dev_wlad",
												"type": "LinkedServiceReference"
											},
											"typeProperties": {
												"scripts": [
													{
														"type": "Query",
														"text": "INSERT INTO INGEST.RAW_TACTICAL_EDGEWELL_TRIMMED(ID,DATE,SKU_ID ,SKU_DESCRIPTION ,SKU_CODE ,SKU_EAN ,CLIENT,SUB_CALL ,RETAILER,STORE_ID ,STORE_DESCRIPTION ,CALL_DATE,CALL_ID) \nSELECT ID,DATE,SKU_ID ,SKU_DESCRIPTION ,SKU_CODE ,SKU_EAN ,CLIENT,SUB_CALL ,RETAILER,STORE_ID ,STORE_DESCRIPTION ,CALL_DATE,CALL_ID FROM INGEST.RAW_TACTICAL_EDGEWELL\n"
													}
												],
												"scriptBlockExecutionTimeout": "02:00:00"
											}
										},
										{
											"name": "Script2",
											"type": "Script",
											"dependsOn": [
												{
													"activity": "Script1",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"linkedServiceName": {
												"referenceName": "ls_sf_dev_wlad",
												"type": "LinkedServiceReference"
											},
											"typeProperties": {
												"scripts": [
													{
														"type": "Query",
														"text": "INSERT INTO INGEST.RAW_TACTICAL_EDGEWELL_TRIMMED_QUESTIONS(CALL_ID, QUESTION, RESPONSE, ADDITIONAL_INFO) \nSELECT CALL_ID, QUESTION, RESPONSE, ADDITIONAL_INFO FROM INGEST.RAW_TACTICAL_EDGEWELL;\n"
													}
												],
												"scriptBlockExecutionTimeout": "02:00:00"
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-22T15:21:46Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_sf_dev_wlad')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG ETL Generic Load SFTP')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Set Variable Cfg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DiffRG_SourceSFTPJSON",
								"type": "DatasetReference",
								"parameters": {
									"Username": {
										"value": "@json(variables('cfg_sftp')).integration.expd8.username",
										"type": "Expression"
									},
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"FilePath": "/outbound/processed",
									"Hostname": {
										"value": "@json(variables('cfg_sftp')).integration.expd8.hostname",
										"type": "Expression"
									},
									"SecretName": {
										"value": "@json(variables('cfg_sftp')).integration.expd8.secret_name",
										"type": "Expression"
									}
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false,
								"disableChunking": false
							},
							"formatSettings": {
								"type": "JsonReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@equals(item().type,'File')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ForEach File",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Filter Filename').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy JSON from SFTP to Azure",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "SftpReadSettings",
												"recursive": true,
												"wildcardFolderPath": "/outbound/processed",
												"wildcardFileName": "tactical-bacardi-tesco-ond-shippers-2023-02102023-25122023-20231231210008.json",
												"enablePartitionDiscovery": false,
												"disableChunking": false
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "JsonSink",
											"storeSettings": {
												"type": "AzureFileStorageWriteSettings"
											},
											"formatSettings": {
												"type": "JsonWriteSettings"
											}
										},
										"enableStaging": true,
										"stagingSettings": {
											"linkedServiceName": {
												"referenceName": "ls_blob_dev_wlad",
												"type": "LinkedServiceReference"
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DiffRG_SourceSFTPJSON",
											"type": "DatasetReference",
											"parameters": {
												"Username": {
													"value": "@json(variables('cfg_sftp')).integration.expd8.username",
													"type": "Expression"
												},
												"DataWarehouseName": {
													"value": "@pipeline().parameters.DataWarehouseName",
													"type": "Expression"
												},
												"FilePath": "/outbound/processed",
												"Hostname": {
													"value": "@json(variables('cfg_sftp')).integration.expd8.hostname",
													"type": "Expression"
												},
												"SecretName": {
													"value": "@json(variables('cfg_sftp')).integration.expd8.secret_name",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DiffRG_TargetFileJSON",
											"type": "DatasetReference",
											"parameters": {
												"DatawareHouseName": {
													"value": "@pipeline().parameters.DataWarehouseName",
													"type": "Expression"
												},
												"FileName": {
													"value": "@item().name",
													"type": "Expression"
												},
												"StorageAccountName": {
													"value": "@json(variables('cfg_sftp')).storageaccount.name",
													"type": "Expression"
												},
												"FileShare": {
													"value": "@json(variables('cfg_sftp')).storageaccount.fileshare",
													"type": "Expression"
												},
												"KVStorageAccKey": {
													"value": "@json(variables('cfg_sftp')).storageaccount.KVStorageAccKey",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "If File is Tactical",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "Copy JSON from SFTP to Azure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@startswith(item().name, 'tactical')",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "Execute Logic App",
												"type": "WebActivity",
												"dependsOn": [],
												"policy": {
													"timeout": "0.12:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"method": "POST",
													"headers": {},
													"url": "https://prod-10.uksouth.logic.azure.com:443/workflows/78818aae79a34617bb270ea5419a9eb4/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=y1bLXuZtmJMmlJy2BDHiJqHYiCf0Jh5YE3oYTjWumcU",
													"body": {
														"value": "@concat('{\n    \"FileName\": \"', item().name, '\",\n    \"DataWarehouseName\": \"', pipeline().parameters.DataWarehouseName,'\"}')",
														"type": "Expression"
													}
												}
											}
										]
									}
								}
							]
						}
					},
					{
						"name": "Set Variable Cfg",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Get Cfg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "cfg_sftp",
							"value": {
								"value": "@activity('Get Cfg').output.value",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Get Cfg",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"method": "GET",
							"headers": {},
							"url": {
								"value": "@concat('https://az-ukw-ac-dev-wlad.azconfig.io/kv/', pipeline().parameters.DataWarehouseName, '_', pipeline().parameters.Slot)",
								"type": "Expression"
							},
							"authentication": {
								"type": "MSI",
								"resource": "https://az-ukw-ac-dev-wlad.azconfig.io"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Username": {
						"type": "string",
						"defaultValue": "edgewell"
					},
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"cfg_sftp": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-23T19:27:11Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DiffRG_SourceSFTPJSON')]",
				"[concat(variables('factoryId'), '/datasets/DiffRG_TargetFileJSON')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Baccardi')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline Generic Extract JSON",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Extract JSON Debug",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Baccardi"
					},
					"FilenamePattern": {
						"type": "string"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-22T15:21:46Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Extract JSON Debug')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Create Logs')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "set elt_uuid",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "elt_uuid",
							"value": {
								"value": "@if(\n  or(\n    empty(coalesce(pipeline().parameters.uuid,'')),\n    less(length(pipeline().parameters.uuid),32)\n  ),\n  guid('N'),\n  pipeline().parameters.uuid\n)\n\n",
								"type": "Expression"
							}
						}
					},
					{
						"name": "If uuid is empty",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "set elt_uuid",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@or(\nempty(coalesce(pipeline().parameters.uuid,'')),\nless(length(pipeline().parameters.uuid),32)\n)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "Update ingestion",
									"type": "Script",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "ls_sf_dev_wlad",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"parameters": [
													{
														"name": "source_size",
														"type": "Int32",
														"value": "0",
														"direction": "Input"
													},
													{
														"name": "rowsRead",
														"type": "Int16",
														"value": {
															"value": "@pipeline().parameters.rows_read",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "128"
													},
													{
														"name": "rowsCopied",
														"type": "Int16",
														"value": {
															"value": "@pipeline().parameters.rows_copied",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "first_error",
														"type": "String",
														"value": "No",
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "errors_seen",
														"type": "Int16",
														"value": {
															"value": "@pipeline().parameters.errors_seen",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "status",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.status",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "512"
													},
													{
														"name": "elt_uuid",
														"type": "String",
														"value": {
															"value": "@variables('elt_uuid')",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													}
												],
												"type": "NonQuery",
												"text": "update ingest.Logging set \n  source_size = ?,\n  rows_parsed = ?,\n  rows_loaded = ?,\n  first_error = ?,\n  errors_seen = ?,\n  status = ?\nwhere uuid = to_binary(?,'hex')"
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "Create ingestion",
									"type": "Script",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "ls_sf_dev_wlad",
										"type": "LinkedServiceReference",
										"parameters": {
											"DatawarehouseName": "INTERNAL_DEV_WLAD"
										}
									},
									"typeProperties": {
										"scripts": [
											{
												"parameters": [
													{
														"name": "elt_uuid",
														"type": "String",
														"value": {
															"value": "@variables('elt_uuid')",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "local_file",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.local_file",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "128"
													},
													{
														"name": "blob_file",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.blob_file",
															"type": "Expression"
														},
														"direction": "Input"
													},
													{
														"name": "tenant_code",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.tenant_code",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "datasource_code",
														"type": "String",
														"value": {
															"value": "@coalesce(\n    pipeline().parameters.datasource,\n    pipeline().parameters.tenant_code\n)",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "dest_schema",
														"type": "String",
														"value": {
															"value": "@coalesce(\n    pipeline().parameters.dest_schema,\n    json(variables('cfg')).datastore.schema\n)",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "dest_table",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.dest_table",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "32"
													},
													{
														"name": "remarks",
														"type": "String",
														"value": {
															"value": "@pipeline().parameters.remarks",
															"type": "Expression"
														},
														"direction": "Input",
														"size": "512"
													},
													{
														"name": "attr",
														"type": "String",
														"value": {
															"value": "@string(pipeline().parameters.attr)",
															"type": "Expression"
														},
														"direction": "Input"
													},
													{
														"name": "run_id",
														"type": "String",
														"value": {
															"value": "@pipeline()?.TriggeredByPipelineRunId",
															"type": "Expression"
														},
														"direction": "Input"
													},
													{
														"name": "pipeline_name",
														"type": "String",
														"value": {
															"value": "@pipeline()?.TriggeredByPipelineName",
															"type": "Expression"
														},
														"direction": "Input"
													}
												],
												"type": "NonQuery",
												"text": "insert into app.INGEST (uuid, start_time, status, username, host, local_file, blob_file, tenant_code, datasource_code, dest_schema, dest_table, remarks, attr)\n  select to_binary(?,'hex'),\n  current_timestamp,'INIT','ADF','-',\n  ?,\n  ?,\n  ?,\n  ?,\n  ?,\n  ?,\n  ?, \nobject_insert(object_insert(coalesce(try_parse_json(?),object_construct()), 'ADF.TriggeredByPipelineRunId',?),'ADF.TriggeredByPipelineName',?)"
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Set output",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "If uuid is empty",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "uuid",
									"value": {
										"type": "Expression",
										"content": "@variables('elt_uuid')"
									}
								}
							],
							"setSystemVariable": true
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"blob_file": {
						"type": "string"
					},
					"local_file": {
						"type": "string"
					},
					"tenant_code": {
						"type": "string"
					},
					"slot": {
						"type": "string",
						"defaultValue": "prod"
					},
					"datasource": {
						"type": "string"
					},
					"uuid": {
						"type": "string"
					},
					"dest_table": {
						"type": "string"
					},
					"dest_schema": {
						"type": "string"
					},
					"attr": {
						"type": "string"
					},
					"sf_copy_stats": {
						"type": "array",
						"defaultValue": []
					},
					"sf_copy_output": {
						"type": "object"
					},
					"remarks": {
						"type": "string"
					},
					"status": {
						"type": "string"
					},
					"rows_read": {
						"type": "string"
					},
					"rows_copied": {
						"type": "string"
					},
					"errors_seen": {
						"type": "string"
					}
				},
				"variables": {
					"elt_uuid": {
						"type": "String",
						"defaultValue": "00000000000000000000000000000000"
					},
					"subscription_id": {
						"type": "String",
						"defaultValue": "6a4c5e4b-460f-458a-8296-f42254574265"
					},
					"app_config": {
						"type": "Array",
						"defaultValue": []
					},
					"cfg": {
						"type": "String",
						"defaultValue": "{}"
					},
					"fileinfo": {
						"type": "Array",
						"defaultValue": []
					},
					"sf_copy_stats": {
						"type": "Array",
						"defaultValue": []
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:01Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sf_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Edgewell')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline Generic Extract JSON",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Extract JSON Two Step",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								},
								"Slot": "dev"
							}
						}
					},
					{
						"name": "Execute JSON Cleamup",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generic Extract JSON",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic JSON Cleanup",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"Slot": "dev"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string"
					}
				},
				"variables": {
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-15T18:34:31Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Extract JSON Two Step')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic JSON Cleanup')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Copy CSV')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Find CSV Delimiter",
						"type": "ExecuteDataFlow",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "findCSVDelimiter",
								"type": "DataFlowReference",
								"parameters": {
									"fileName": {
										"value": "'@{pipeline().parameters.Filename}'",
										"type": "Expression"
									}
								},
								"datasetParameters": {
									"source1": {
										"FileName": {
											"value": "@string(pipeline().parameters.Filename)",
											"type": "Expression"
										},
										"KVSasUrl": {
											"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
											"type": "Expression"
										}
									},
									"sink1": {
										"FileName": {
											"value": "@string(pipeline().parameters.Filename)",
											"type": "Expression"
										},
										"KVSasUrl": {
											"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
											"type": "Expression"
										}
									}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Find CSV Skip Count",
						"type": "ExecuteDataFlow",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [
							{
								"activity": "Find CSV Delimiter",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "findCSVHeaders",
								"type": "DataFlowReference",
								"parameters": {
									"fileName": {
										"value": "'@{pipeline().parameters.Filename}'",
										"type": "Expression"
									}
								},
								"datasetParameters": {
									"source1": {
										"FileName": {
											"value": "@string(pipeline().parameters.Filename)",
											"type": "Expression"
										},
										"KVSasUrl": {
											"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
											"type": "Expression"
										}
									},
									"sink1": {
										"FileName": {
											"value": "@string(pipeline().parameters.Filename)",
											"type": "Expression"
										},
										"KVSasUrl": {
											"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
											"type": "Expression"
										}
									}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Lookup CSV Delimiter",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "SourceBlobCSV_split",
								"type": "DatasetReference",
								"parameters": {
									"FileName": {
										"value": "@concat('delimiter_', replace(pipeline().parameters.Filename, '.csv', '.txt'))",
										"type": "Expression"
									},
									"KVSasUrl": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "Set Delimiter",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Lookup CSV Delimiter",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "delimiter",
							"value": {
								"value": "@split(activity('Lookup CSV Delimiter').output.firstRow.Prop_0, ':')[1]",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Lookup CSV SkipLineCount",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Set Delimiter",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "SourceBlobCSV_split",
								"type": "DatasetReference",
								"parameters": {
									"FileName": {
										"value": "@concat('headers_', replace(pipeline().parameters.Filename, '.csv', '.txt'))",
										"type": "Expression"
									},
									"KVSasUrl": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "Set SkipLineCount",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Lookup CSV SkipLineCount",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "SkipLineCount",
							"value": {
								"value": "@activity('Lookup CSV SkipLineCount').output.firstRow.Prop_0",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [
							{
								"activity": "Update Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": "Import/InProcess",
									"wildcardFileName": {
										"value": "@pipeline().parameters.Filename",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "DiffRG_FileMover",
								"type": "DatasetReference",
								"parameters": {
									"InOrOut": "InProcess",
									"StorageAccountName": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DiffRG_FileMover",
								"type": "DatasetReference",
								"parameters": {
									"InOrOut": "Processed",
									"StorageAccountName": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Create Initial Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Set SkipLineCount",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": {
									"value": "@split(pipeline().parameters.Filename, '_')[1]",
									"type": "Expression"
								},
								"dest_schema": "INGEST",
								"attr": "{}",
								"status": "Loading",
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Copy data from Source to Ingest",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Create Initial Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"additionalColumns": [
									{
										"name": "DummyNameForETLUUID",
										"value": {
											"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": "Import/InProcess",
									"wildcardFileName": {
										"value": "@pipeline().parameters.Filename",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings",
									"skipLineCount": {
										"value": "@sub(int(variables('SkipLineCount')),1)",
										"type": "Expression"
									}
								}
							},
							"sink": {
								"type": "SnowflakeSink",
								"importSettings": {
									"type": "SnowflakeImportCopyCommand"
								}
							},
							"enableStaging": true,
							"stagingSettings": {
								"linkedServiceName": {
									"referenceName": "ls_blob_dev_split_wlad",
									"type": "LinkedServiceReference",
									"parameters": {
										"KVSasUrl": {
											"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
											"type": "Expression"
										}
									}
								},
								"path": "stagingjson"
							},
							"translator": {
								"value": "@json(activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString)",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "Generic_SourceFileCSV",
								"type": "DatasetReference",
								"parameters": {
									"StorageAccountName": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.Filename",
										"type": "Expression"
									},
									"Delimiter": {
										"value": "@variables('delimiter')",
										"type": "Expression"
									},
									"SkipCount": {
										"value": "@variables('SkipLineCount')",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DiffRG_TargetTable",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@json(pipeline().parameters.cfg).datastore.tablename_csv_js",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@json(pipeline().parameters.cfg).datastore.schema",
										"type": "Expression"
									},
									"DatawarehouseName": {
										"value": "@json(pipeline().parameters.cfg).datastore.database",
										"type": "Expression"
									},
									"AccountName": {
										"value": "@json(pipeline().parameters.cfg).datastore.account",
										"type": "Expression"
									},
									"Username": {
										"value": "@json(pipeline().parameters.cfg).datastore.username",
										"type": "Expression"
									},
									"Database": {
										"value": "@json(pipeline().parameters.cfg).datastore.database",
										"type": "Expression"
									},
									"Warehouse": {
										"value": "@json(pipeline().parameters.cfg).datastore.warehouse",
										"type": "Expression"
									},
									"Password": {
										"value": "@json(pipeline().parameters.cfg).datastore.password_kv",
										"type": "Expression"
									},
									"Role": {
										"value": "@json(pipeline().parameters.cfg).datastore.role",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Update Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy data from Source to Ingest",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"uuid": {
									"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
									"type": "Expression"
								},
								"dest_table": {
									"value": "@if(startswith(pipeline().parameters.Filename, 'tactical'),json(pipeline().parameters.cfg).datastore.tablename_tactical , json(pipeline().parameters.cfg).datastore.tablename_reports )",
									"type": "Expression"
								},
								"dest_schema": "INGESTION",
								"attr": "{}",
								"status": "OK",
								"rows_read": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
									"type": "Expression"
								},
								"rows_copied": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
									"type": "Expression"
								},
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Update Log Fail",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy data from Source to Ingest",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "DiffRG ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"uuid": {
									"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
									"type": "Expression"
								},
								"dest_table": {
									"value": "@if(startswith(pipeline().parameters.Filename, 'tactical'),json(pipeline().parameters.cfg).datastore.tablename_tactical , json(pipeline().parameters.cfg).datastore.tablename_reports )",
									"type": "Expression"
								},
								"dest_schema": {
									"value": "@json(pipeline().parameters.cfg).datastore.schema",
									"type": "Expression"
								},
								"attr": "{}",
								"status": "FAILED",
								"rows_read": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
									"type": "Expression"
								},
								"rows_copied": {
									"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
									"type": "Expression"
								},
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Copy Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Update Log Fail",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "567",
							"errorCode": "Failed to copy data from Source to Ingest"
						}
					},
					{
						"name": "Delete Delimiter File",
						"type": "Delete",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [
							{
								"activity": "Move File to Processed",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "SourceBlobCSV_split",
								"type": "DatasetReference",
								"parameters": {
									"FileName": {
										"value": "@concat('delimiter_', replace(pipeline().parameters.Filename, '.csv', '.txt'))",
										"type": "Expression"
									},
									"KVSasUrl": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "AzureBlobStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					},
					{
						"name": "Delete SkipLineCount File",
						"type": "Delete",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [
							{
								"activity": "Delete Delimiter File",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "SourceBlobCSV_split",
								"type": "DatasetReference",
								"parameters": {
									"FileName": {
										"value": "@concat('headers_', replace(pipeline().parameters.Filename, '.csv', '.txt'))",
										"type": "Expression"
									},
									"KVSasUrl": {
										"value": "@json(pipeline().parameters.cfg).storageaccount.sas_url_kv_name",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "AzureBlobStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Find CSV Skip Count",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping CSV",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.Filename",
									"type": "Expression"
								},
								"StorageAccountName": {
									"value": "@json(pipeline().parameters.cfg).storageaccount.name",
									"type": "Expression"
								},
								"FileShare": {
									"value": "@json(pipeline().parameters.cfg).storageaccount.fileshare",
									"type": "Expression"
								},
								"KVStorageAccKey": {
									"value": "@json(pipeline().parameters.cfg).storageaccount.KVStorageAccKey",
									"type": "Expression"
								},
								"cfg": {
									"value": "@pipeline().parameters.cfg",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"Filename": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					},
					"cfg": {
						"type": "string"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					},
					"cfg": {
						"type": "String"
					},
					"delimiter": {
						"type": "String"
					},
					"SkipLineCount": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/findCSVDelimiter')]",
				"[concat(variables('factoryId'), '/dataflows/findCSVHeaders')]",
				"[concat(variables('factoryId'), '/datasets/SourceBlobCSV_split')]",
				"[concat(variables('factoryId'), '/datasets/DiffRG_FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/DiffRG ETL Create Logs')]",
				"[concat(variables('factoryId'), '/datasets/Generic_SourceFileCSV')]",
				"[concat(variables('factoryId'), '/datasets/DiffRG_TargetTable')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping CSV')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Copy JSON')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@pipeline().parameters.Filename",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Create Initial Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureFileStorageReadSettings",
														"recursive": true,
														"wildcardFolderPath": {
															"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
															"type": "Expression"
														},
														"wildcardFileName": {
															"value": "@pipeline().parameters.Filename",
															"type": "Expression"
														},
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													},
													"path": "stagingjson"
												},
												"translator": {
													"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": {
															"value": "@if(startswith(pipeline().parameters.Filename, 'tactical'),'RAW_TACTICAL_EDGEWELL' , 'RAW_EDGEWELL_REPORTS' )",
															"type": "Expression"
														},
														"SchemaName": "INGEST",
														"DatawarehouseName": "INTERNAL_DEV_WLAD"
													}
												}
											]
										},
										{
											"name": "Update Log",
											"type": "ExecutePipeline",
											"dependsOn": [
												{
													"activity": "Copy data from Source to Ingest",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"pipeline": {
													"referenceName": "ETL Create Logs",
													"type": "PipelineReference"
												},
												"waitOnCompletion": true,
												"parameters": {
													"local_file": {
														"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
														"type": "Expression"
													},
													"tenant_code": {
														"value": "@toLower(pipeline().parameters.DataWarehouseName)",
														"type": "Expression"
													},
													"slot": {
														"value": "@pipeline().parameters.Slot",
														"type": "Expression"
													},
													"datasource": "tesco",
													"uuid": {
														"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
														"type": "Expression"
													},
													"dest_table": "RAW_TACTICAL_EDGEWELL",
													"dest_schema": "INGEST",
													"attr": "{}",
													"status": {
														"value": "@activity('Copy data from Source to Ingest').output.executionDetails[0].status",
														"type": "Expression"
													},
													"rows_read": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
														"type": "Expression"
													},
													"rows_copied": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
														"type": "Expression"
													}
												}
											}
										},
										{
											"name": "Update Log Fail",
											"type": "ExecutePipeline",
											"dependsOn": [
												{
													"activity": "Copy data from Source to Ingest",
													"dependencyConditions": [
														"Failed"
													]
												}
											],
											"policy": {
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"pipeline": {
													"referenceName": "ETL Create Logs",
													"type": "PipelineReference"
												},
												"waitOnCompletion": true,
												"parameters": {
													"local_file": {
														"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
														"type": "Expression"
													},
													"tenant_code": {
														"value": "@toLower(pipeline().parameters.DataWarehouseName)",
														"type": "Expression"
													},
													"slot": {
														"value": "@pipeline().parameters.Slot",
														"type": "Expression"
													},
													"datasource": "tesco",
													"uuid": {
														"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
														"type": "Expression"
													},
													"dest_table": "RAW_TACTICAL_EDGEWELL",
													"dest_schema": "INGEST",
													"attr": "{}",
													"status": {
														"value": "@activity('Copy data from Source to Ingest').output.executionDetails[0].status",
														"type": "Expression"
													},
													"rows_read": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
														"type": "Expression"
													},
													"rows_copied": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
														"type": "Expression"
													}
												}
											}
										},
										{
											"name": "Copy Fail",
											"type": "Fail",
											"dependsOn": [
												{
													"activity": "Update Log Fail",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"userProperties": [],
											"typeProperties": {
												"message": "567",
												"errorCode": "Failed to copy data from Source to Ingest"
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					},
					{
						"name": "Create Initial Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', pipeline().parameters.Filename)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"dest_schema": "INGEST",
								"attr": "{}",
								"status": "Loading"
							}
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping Two Step",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.Filename",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"Filename": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Create Logs')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping Two Step')]",
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract CSV Two Step')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@equals(item().type,'File')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ForEach File",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Filter Filename').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"activities": [
								{
									"name": "Execute Pipeline Copy JSON",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"policy": {
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "ETL Generic Copy CSV",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"DataWarehouseName": {
												"value": "@pipeline().parameters.DataWarehouseName",
												"type": "Expression"
											},
											"Filename": {
												"value": "@item().name",
												"type": "Expression"
											},
											"Slot": {
												"value": "@pipeline().parameters.Slot",
												"type": "Expression"
											},
											"cfg": {
												"value": "@variables('cfg')",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "Set Variable Cfg",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Get Cfg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "cfg",
							"value": {
								"value": "@activity('Get Cfg').output.value",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Get Cfg",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"method": "GET",
							"headers": {},
							"url": {
								"value": "@concat('https://az-ukw-ac-dev-wlad.azconfig.io/kv/', pipeline().parameters.DataWarehouseName, '_', pipeline().parameters.Slot)",
								"type": "Expression"
							},
							"authentication": {
								"type": "MSI",
								"resource": "https://az-ukw-ac-dev-wlad.azconfig.io"
							}
						}
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Set Variable Cfg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DiffRG_FileMover",
								"type": "DatasetReference",
								"parameters": {
									"InOrOut": "InProcess",
									"StorageAccountName": {
										"value": "@json(variables('cfg')).storageaccount.name",
										"type": "Expression"
									},
									"FileShare": {
										"value": "@json(variables('cfg')).storageaccount.fileshare",
										"type": "Expression"
									},
									"KVStorageAccKey": {
										"value": "@json(variables('cfg')).storageaccount.KVStorageAccKey",
										"type": "Expression"
									}
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "Edgewell_JS"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					},
					"cfg": {
						"type": "String"
					},
					"delimiter": {
						"type": "String"
					},
					"SkipLineCount": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-15T17:00:11Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DiffRG_FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Copy CSV')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON ALL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Dummy Action",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Dummy Fail (this is supposed to fail)",
							"errorCode": "555"
						}
					},
					{
						"name": "Lookup JSON",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "SourceFileJSON",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Convert JSON_Properties String to Array",
						"description": "Contains an array of properties in JSON returned by the previous step",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties",
							"value": {
								"value": "@split(variables('Helper_String'), '^')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Until",
						"type": "Until",
						"dependsOn": [
							{
								"activity": "Set Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(variables('Current_Property'),variables('Number_of_JSON_Properties'))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Append Column Mapping String",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Column Mapping String Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column_Mapping_String",
										"value": {
											"value": "@variables('Column Mapping String Helper')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Column Mapping String Helper",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column Mapping String Helper",
										"value": {
											"value": "@concat(variables('Column_Mapping_String'),'{\"source\": {\"name\": \"', variables('JSON_Properties')[variables('Current_Property')], '\"},\"target\":{\"name\":\"', variables('JSON_Properties')[variables('Current_Property')], '\"}},')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property Helper",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Append Column Mapping String",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property_Helper",
										"value": {
											"value": "@add(variables('Current_Property'),2)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Current Property Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property",
										"value": {
											"value": "@variables('Current_Property_Helper')",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.12:00:00"
						}
					},
					{
						"name": "Set Number of JSON Properties",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Number_of_JSON_Properties",
							"value": {
								"value": "@div(length(variables('JSON_Properties')), 2)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Set Current_Property",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Current_Property",
							"value": 0
						}
					},
					{
						"name": "Set Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set Current_Property",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Set Number of JSON Properties",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": "{\n  \"type\": \"TabularTranslator\",\n  \"mappings\": ["
						}
					},
					{
						"name": "Clean Up Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Until",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column Mapping String Helper",
							"value": {
								"value": "@substring(variables('Column_Mapping_String'), 0, sub(length(variables('Column_Mapping_String')), 1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Finalize Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": {
								"value": "@concat(variables('Column Mapping String Helper'), ']}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Set JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties_String",
							"value": {
								"value": "@string(activity('Lookup JSON').output.firstRow)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Clean Up JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Helper_String",
							"value": {
								"value": "@replace(replace(replace(replace(replace(replace(replace(replace(variables('JSON_Properties_String'), '/', ''), '\":', '^'), '\"', ''), ' ,', '---'), ',', '^'), '---', ' ,'), '{', ''), '}', '')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@activity('Filter Filename').output.value[0].name",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@and(equals(item().type,'File'),startswith(item().name, pipeline().parameters.FilenamePattern))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Finalize Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"state": "Inactive",
											"onInactiveMarkAs": "Succeeded",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureFileStorageReadSettings",
														"recursive": true,
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "JsonSink",
													"storeSettings": {
														"type": "AzureFileStorageWriteSettings"
													},
													"formatSettings": {
														"type": "JsonWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"value": "@variables('Column_Mapping_String')",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											]
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-11T18:02:32Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/FileMover')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON Blob Without Logs')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@activity('Filter Filename').output.value[0].name",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"state": "Inactive",
						"onInactiveMarkAs": "Skipped",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@and(equals(item().type,'File'),startswith(item().name, pipeline().parameters.FilenamePattern))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureBlobStorageReadSettings",
														"recursive": true,
														"wildcardFileName": {
															"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
															"type": "Expression"
														},
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													},
													"path": "stagingjson"
												},
												"translator": {
													"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceBlobJSON",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@toLower(pipeline().parameters.DataWarehouseName)",
															"type": "Expression"
														}
													}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											]
										}
									]
								}
							]
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping Blob",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping Blob')]",
				"[concat(variables('factoryId'), '/datasets/SourceBlobJSON')]",
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON Blob')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"state": "Inactive",
						"onInactiveMarkAs": "Succeeded",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@activity('Filter Filename').output.value[0].name",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Create Initial Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureBlobStorageReadSettings",
														"recursive": true,
														"wildcardFileName": {
															"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
															"type": "Expression"
														},
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													},
													"path": "stagingjson"
												},
												"translator": {
													"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceBlobJSON",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@toLower(pipeline().parameters.DataWarehouseName)",
															"type": "Expression"
														}
													}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											]
										},
										{
											"name": "Update Log",
											"type": "ExecutePipeline",
											"dependsOn": [
												{
													"activity": "Copy data from Source to Ingest",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"pipeline": {
													"referenceName": "ETL Create Logs",
													"type": "PipelineReference"
												},
												"waitOnCompletion": true,
												"parameters": {
													"blob_file": {
														"value": "@concat(toLower(pipeline().parameters.DataWarehouseName), activity('Filter Filename').output.value[0].name)",
														"type": "Expression"
													},
													"tenant_code": {
														"value": "@toLower(pipeline().parameters.DataWarehouseName)",
														"type": "Expression"
													},
													"slot": {
														"value": "@pipeline().parameters.Slot",
														"type": "Expression"
													},
													"datasource": "tesco",
													"uuid": {
														"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
														"type": "Expression"
													},
													"dest_table": "RAW_TACTICAL_EDGEWELL",
													"dest_schema": "INGEST",
													"attr": "{}",
													"status": {
														"value": "@activity('Copy data from Source to Ingest').output.executionDetails[0].status",
														"type": "Expression"
													},
													"rows_read": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
														"type": "Expression"
													},
													"rows_copied": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
														"type": "Expression"
													}
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping Blob",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@and(equals(item().type,'File'),startswith(item().name, pipeline().parameters.FilenamePattern))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Create Initial Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"blob_file": {
									"value": "@concat(toLower(pipeline().parameters.DataWarehouseName), activity('Filter Filename').output.value[0].name)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"dest_schema": "INGEST",
								"attr": "{}",
								"status": "Loading"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Full Solution Wildcard File"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping Blob')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Create Logs')]",
				"[concat(variables('factoryId'), '/datasets/SourceBlobJSON')]",
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON Debug')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@activity('Filter Filename').output.value[0].name",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@and(equals(item().type,'File'),startswith(item().name, pipeline().parameters.FilenamePattern))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"state": "Inactive",
											"onInactiveMarkAs": "Succeeded",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureFileStorageReadSettings",
														"recursive": true,
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "JsonSink",
													"storeSettings": {
														"type": "AzureFileStorageWriteSettings"
													},
													"formatSettings": {
														"type": "JsonWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											]
										}
									]
								}
							]
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-12T14:56:23Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping')]",
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON Two Step')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@equals(item().type,'File')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ForEach File",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Filter Filename').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"activities": [
								{
									"name": "Execute Pipeline Copy JSON",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"policy": {
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "ETL Generic Copy JSON",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"DataWarehouseName": {
												"value": "@pipeline().parameters.DataWarehouseName",
												"type": "Expression"
											},
											"Filename": {
												"value": "@item().name",
												"type": "Expression"
											},
											"Slot": {
												"value": "@pipeline().parameters.Slot",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-15T17:00:11Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Copy JSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON Without Logs')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@activity('Filter Filename').output.value[0].name",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@and(equals(item().type,'File'),startswith(item().name, pipeline().parameters.FilenamePattern))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Succeeded",
									"Skipped"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureFileStorageReadSettings",
														"recursive": true,
														"wildcardFolderPath": {
															"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
															"type": "Expression"
														},
														"wildcardFileName": {
															"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
															"type": "Expression"
														},
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													},
													"path": "stagingjson"
												},
												"translator": {
													"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											]
										}
									]
								}
							]
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping')]",
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Extract JSON')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Move File to Processed",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Switch",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "BinarySource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@activity('Filter Filename').output.value[0].name",
										"type": "Expression"
									},
									"deleteFilesAfterCompletion": true
								},
								"formatSettings": {
									"type": "BinaryReadSettings"
								}
							},
							"sink": {
								"type": "BinarySink",
								"storeSettings": {
									"type": "AzureFileStorageWriteSettings",
									"copyBehavior": "PreserveHierarchy"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "InProcess"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"InOrOut": "Processed"
								}
							}
						]
					},
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Skipped",
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "FileMover",
								"type": "DatasetReference",
								"parameters": {
									"DataWarehouseName": "Edgewell",
									"InOrOut": "InProcess"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "AzureFileStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							},
							"formatSettings": {
								"type": "BinaryReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@and(equals(item().type,'File'),startswith(item().name, pipeline().parameters.FilenamePattern))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Create Initial Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Copy data from Source to Ingest",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "JsonSource",
													"storeSettings": {
														"type": "AzureFileStorageReadSettings",
														"recursive": true,
														"wildcardFolderPath": {
															"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
															"type": "Expression"
														},
														"wildcardFileName": {
															"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
															"type": "Expression"
														},
														"enablePartitionDiscovery": false
													},
													"formatSettings": {
														"type": "JsonReadSettings"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													},
													"path": "stagingjson"
												},
												"translator": {
													"value": "@activity('Execute Pipeline Generate Column Mapping').output.pipelineReturnValue.ColumnMappingString",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "SourceFileJSON",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											]
										},
										{
											"name": "Update Log",
											"type": "ExecutePipeline",
											"dependsOn": [
												{
													"activity": "Copy data from Source to Ingest",
													"dependencyConditions": [
														"Completed"
													]
												}
											],
											"policy": {
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"pipeline": {
													"referenceName": "ETL Create Logs",
													"type": "PipelineReference"
												},
												"waitOnCompletion": true,
												"parameters": {
													"local_file": {
														"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', activity('Filter Filename').output.value[0].name)",
														"type": "Expression"
													},
													"tenant_code": {
														"value": "@toLower(pipeline().parameters.DataWarehouseName)",
														"type": "Expression"
													},
													"slot": {
														"value": "@pipeline().parameters.Slot",
														"type": "Expression"
													},
													"datasource": "tesco",
													"uuid": {
														"value": "@activity('Create Initial Log').output.pipelineReturnValue.uuid",
														"type": "Expression"
													},
													"dest_table": "RAW_TACTICAL_EDGEWELL",
													"dest_schema": "INGEST",
													"attr": "{}",
													"status": {
														"value": "@activity('Copy data from Source to Ingest').output.executionDetails[0].status",
														"type": "Expression"
													},
													"rows_read": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsRead",
														"type": "Expression"
													},
													"rows_copied": {
														"value": "@activity('Copy data from Source to Ingest').output.rowsCopied",
														"type": "Expression"
													}
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Execute Pipeline Generate Column Mapping",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Generic Generate Column Mapping",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"DataWarehouseName": {
									"value": "@pipeline().parameters.DataWarehouseName",
									"type": "Expression"
								},
								"FilenamePattern": {
									"value": "@pipeline().parameters.FilenamePattern",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Fail",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Execute Pipeline Generate Column Mapping",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account or File Does Not Exist",
							"errorCode": "556"
						}
					},
					{
						"name": "Create Initial Log",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "ETL Create Logs",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"local_file": {
									"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/', activity('Filter Filename').output.value[0].name)",
									"type": "Expression"
								},
								"tenant_code": {
									"value": "@toLower(pipeline().parameters.DataWarehouseName)",
									"type": "Expression"
								},
								"slot": {
									"value": "@pipeline().parameters.Slot",
									"type": "Expression"
								},
								"datasource": "tesco",
								"dest_schema": "INGEST",
								"attr": "{}",
								"status": "Loading"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Full Solution Wildcard File"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/FileMover')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Generic Generate Column Mapping')]",
				"[concat(variables('factoryId'), '/pipelines/ETL Create Logs')]",
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Generate Column Mapping Blob')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Failed To Connect",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account",
							"errorCode": "555"
						}
					},
					{
						"name": "Lookup JSON",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"wildcardFileName": {
										"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "SourceBlobJSON",
								"type": "DatasetReference",
								"parameters": {
									"ContainerName": {
										"value": "@toLower(pipeline().parameters.DataWarehouseName)",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "If File Exists",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@bool(contains(activity('Lookup JSON').output, 'firstRow'))",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "File Not Found",
									"type": "Fail",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"message": "File Not Found",
										"errorCode": "554"
									}
								}
							]
						}
					},
					{
						"name": "Convert JSON_Properties String to Array",
						"description": "Contains an array of properties in JSON returned by the previous step",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties",
							"value": {
								"value": "@split(variables('Helper_String'), '^')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Until",
						"type": "Until",
						"dependsOn": [
							{
								"activity": "Set Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(variables('Current_Property'), sub(variables('Number_of_JSON_Properties'), 1))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Append Column Mapping String",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Column Mapping String Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column_Mapping_String",
										"value": {
											"value": "@variables('Column Mapping String Helper')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Column Mapping String Helper",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column Mapping String Helper",
										"value": {
											"value": "@concat(variables('Column_Mapping_String'),'{\"source\": {\"name\": \"', variables('JSON_Properties')[variables('Current_Property')], '\"},\"target\":{\"name\":\"', variables('JSON_Properties')[variables('Current_Property')], '\"}},')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property Helper",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Append Column Mapping String",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property_Helper",
										"value": {
											"value": "@add(variables('Current_Property'),2)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Current Property Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property",
										"value": {
											"value": "@variables('Current_Property_Helper')",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.12:00:00"
						}
					},
					{
						"name": "Set Number of JSON Properties",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Number_of_JSON_Properties",
							"value": {
								"value": "@length(variables('JSON_Properties'))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Set Current_Property",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Current_Property",
							"value": 0
						}
					},
					{
						"name": "Set Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set Current_Property",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Set Number of JSON Properties",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": "{\n  \"type\": \"TabularTranslator\",\n  \"mappings\": ["
						}
					},
					{
						"name": "Clean Up Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Until",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column Mapping String Helper",
							"value": {
								"value": "@substring(variables('Column_Mapping_String'), 0, sub(length(variables('Column_Mapping_String')), 1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Finalize Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "ColumnMappingString",
									"value": {
										"type": "Expression",
										"content": "@concat(variables('Column Mapping String Helper'), ']}')"
									}
								}
							],
							"setSystemVariable": true
						}
					},
					{
						"name": "Set JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "If File Exists",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties_String",
							"value": {
								"value": "@string(activity('Lookup JSON').output.firstRow)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Clean Up JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Helper_String",
							"value": {
								"value": "@replace(replace(replace(replace(replace(replace(replace(replace(variables('JSON_Properties_String'), '/', ''), '\":', '^'), '\"', ''), ' ,', '---'), ',', '^'), '---', ' ,'), '{', ''), '}', '')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Full Solution Wildcard File"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-15T15:58:39Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceBlobJSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Generate Column Mapping CSV')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Failed To Connect",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account",
							"errorCode": "555"
						}
					},
					{
						"name": "Lookup JSON",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SnowflakeSource",
								"query": "select column_name, ordinal_position from information_schema.columns where table_name='EDGEWELL_JS_CSV_WLAD' and column_name <> 'ELT_UUID' order by ordinal_position asc;",
								"exportSettings": {
									"type": "SnowflakeExportCopyCommand"
								}
							},
							"dataset": {
								"referenceName": "DiffRG_TargetTable",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@json(pipeline().parameters.cfg).datastore.tablename_csv_js",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@json(pipeline().parameters.cfg).datastore.schema",
										"type": "Expression"
									},
									"DatawarehouseName": {
										"value": "@json(pipeline().parameters.cfg).datastore.warehouse",
										"type": "Expression"
									},
									"AccountName": {
										"value": "@json(pipeline().parameters.cfg).datastore.account",
										"type": "Expression"
									},
									"Username": {
										"value": "@json(pipeline().parameters.cfg).datastore.username",
										"type": "Expression"
									},
									"Database": {
										"value": "@json(pipeline().parameters.cfg).datastore.database",
										"type": "Expression"
									},
									"Warehouse": {
										"value": "@json(pipeline().parameters.cfg).datastore.warehouse",
										"type": "Expression"
									},
									"Password": {
										"value": "@json(pipeline().parameters.cfg).datastore.password_kv",
										"type": "Expression"
									},
									"Role": {
										"value": "@json(pipeline().parameters.cfg).datastore.role",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Set Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": "{\n  \"type\": \"TabularTranslator\",\n  \"mappings\": ["
						}
					},
					{
						"name": "Clean Up Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ForEach Column",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column Mapping String Helper",
							"value": {
								"value": "@concat(variables('Column_Mapping_String'), '{\"source\": { \"name\": \"DummyNameForETLUUID\" }, \"sink\": {\"name\": \"ELT_UUID\"}}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Finalize Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "ColumnMappingString",
									"value": {
										"type": "Expression",
										"content": "@concat(variables('Column Mapping String Helper'), ']}')"
									}
								}
							],
							"setSystemVariable": true
						}
					},
					{
						"name": "ForEach Column",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Set Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup JSON').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "Append Column Mapping String_copy1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Column Mapping String Helper_copy1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column_Mapping_String",
										"value": {
											"value": "@variables('Column Mapping String Helper')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Column Mapping String Helper_copy1",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column Mapping String Helper",
										"value": {
											"value": "@concat(variables('Column_Mapping_String'),'{\"source\": {\"ordinal\": ', string(sub(int(item().ORDINAL_POSITION),1)), ', \"type\": \"String\"},\"sink\":{\"name\":\"',item().COLUMN_NAME , '\"}},')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					},
					"StorageAccountName": {
						"type": "string"
					},
					"FileShare": {
						"type": "string"
					},
					"KVStorageAccKey": {
						"type": "string"
					},
					"cfg": {
						"type": "string"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-22T18:37:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DiffRG_TargetTable')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Generate Column Mapping Two Step')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Failed To Connect",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account",
							"errorCode": "555"
						}
					},
					{
						"name": "Lookup JSON",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@pipeline().parameters.FilenamePattern",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "SourceFileJSON",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "If File Exists",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@bool(contains(activity('Lookup JSON').output, 'firstRow'))",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "File Not Found",
									"type": "Fail",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"message": "File Not Found",
										"errorCode": "554"
									}
								}
							]
						}
					},
					{
						"name": "Convert JSON_Properties String to Array",
						"description": "Contains an array of properties in JSON returned by the previous step",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties",
							"value": {
								"value": "@split(variables('Helper_String'), '^')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Until",
						"type": "Until",
						"dependsOn": [
							{
								"activity": "Set Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(variables('Current_Property'), sub(variables('Number_of_JSON_Properties'), 1))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Append Column Mapping String",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Column Mapping String Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column_Mapping_String",
										"value": {
											"value": "@variables('Column Mapping String Helper')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Column Mapping String Helper",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column Mapping String Helper",
										"value": {
											"value": "@concat(variables('Column_Mapping_String'),'{\"source\": {\"name\": \"', variables('JSON_Properties')[variables('Current_Property')], '\"},\"target\":{\"name\":\"', replace(replace(replace(replace(variables('JSON_Properties')[variables('Current_Property')], ' ', '_'), '.', ''), '!', ''), '?', ''), '\"}},')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property Helper",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Append Column Mapping String",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property_Helper",
										"value": {
											"value": "@add(variables('Current_Property'),2)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Current Property Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property",
										"value": {
											"value": "@variables('Current_Property_Helper')",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.12:00:00"
						}
					},
					{
						"name": "Set Number of JSON Properties",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Number_of_JSON_Properties",
							"value": {
								"value": "@length(variables('JSON_Properties'))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Set Current_Property",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Current_Property",
							"value": 0
						}
					},
					{
						"name": "Set Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set Current_Property",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Set Number of JSON Properties",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": "{\n  \"type\": \"TabularTranslator\",\n  \"mappings\": ["
						}
					},
					{
						"name": "Clean Up Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Until",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column Mapping String Helper",
							"value": {
								"value": "@substring(variables('Column_Mapping_String'), 0, sub(length(variables('Column_Mapping_String')), 1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Finalize Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "ColumnMappingString",
									"value": {
										"type": "Expression",
										"content": "@concat(variables('Column Mapping String Helper'), ']}')"
									}
								}
							],
							"setSystemVariable": true
						}
					},
					{
						"name": "Set JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "If File Exists",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties_String",
							"value": {
								"value": "@string(activity('Lookup JSON').output.firstRow)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Clean Up JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Helper_String",
							"value": {
								"value": "@replace(replace(replace(replace(replace(replace(replace(replace(replace(variables('JSON_Properties_String'), ',\"', '^'),'/', ''), '\":', '^'), '\"', ''), ' ,', '---'), ',', ','), '---', ' ,'), '{', ''), '}', '')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-15T18:22:46Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Generate Column Mapping')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Failed To Connect",
						"type": "Fail",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"message": "Failed to connect to Storage Account",
							"errorCode": "555"
						}
					},
					{
						"name": "Lookup JSON",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat('Import/',pipeline().parameters.DataWarehouseName,'/InProcess/')",
										"type": "Expression"
									},
									"wildcardFileName": {
										"value": "@concat(pipeline().parameters.FilenamePattern, '*.json')",
										"type": "Expression"
									},
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "SourceFileJSON",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "If File Exists",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "Lookup JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@bool(contains(activity('Lookup JSON').output, 'firstRow'))",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "File Not Found",
									"type": "Fail",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"message": "File Not Found",
										"errorCode": "554"
									}
								}
							]
						}
					},
					{
						"name": "Convert JSON_Properties String to Array",
						"description": "Contains an array of properties in JSON returned by the previous step",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties",
							"value": {
								"value": "@split(variables('Helper_String'), '^')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Until",
						"type": "Until",
						"dependsOn": [
							{
								"activity": "Set Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(variables('Current_Property'), sub(variables('Number_of_JSON_Properties'), 1))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Append Column Mapping String",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Column Mapping String Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column_Mapping_String",
										"value": {
											"value": "@variables('Column Mapping String Helper')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Column Mapping String Helper",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Column Mapping String Helper",
										"value": {
											"value": "@concat(variables('Column_Mapping_String'),'{\"source\": {\"name\": \"', variables('JSON_Properties')[variables('Current_Property')], '\"},\"target\":{\"name\":\"', variables('JSON_Properties')[variables('Current_Property')], '\"}},')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property Helper",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Append Column Mapping String",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property_Helper",
										"value": {
											"value": "@add(variables('Current_Property'),2)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set Current Property",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set Current Property Helper",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "Current_Property",
										"value": {
											"value": "@variables('Current_Property_Helper')",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.12:00:00"
						}
					},
					{
						"name": "Set Number of JSON Properties",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Number_of_JSON_Properties",
							"value": {
								"value": "@length(variables('JSON_Properties'))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Set Current_Property",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Convert JSON_Properties String to Array",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Current_Property",
							"value": 0
						}
					},
					{
						"name": "Set Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set Current_Property",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Set Number of JSON Properties",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column_Mapping_String",
							"value": "{\n  \"type\": \"TabularTranslator\",\n  \"mappings\": ["
						}
					},
					{
						"name": "Clean Up Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Until",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Column Mapping String Helper",
							"value": {
								"value": "@substring(variables('Column_Mapping_String'), 0, sub(length(variables('Column_Mapping_String')), 1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Finalize Column Mapping String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Clean Up Column Mapping String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "pipelineReturnValue",
							"value": [
								{
									"key": "ColumnMappingString",
									"value": {
										"type": "Expression",
										"content": "@concat(variables('Column Mapping String Helper'), ']}')"
									}
								}
							],
							"setSystemVariable": true
						}
					},
					{
						"name": "Set JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "If File Exists",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "JSON_Properties_String",
							"value": {
								"value": "@string(activity('Lookup JSON').output.firstRow)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "Clean Up JSON Properties String",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "Set JSON Properties String",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "Helper_String",
							"value": {
								"value": "@replace(replace(replace(replace(replace(replace(replace(replace(variables('JSON_Properties_String'), '/', ''), '\":', '^'), '\"', ''), ' ,', '---'), ',', '^'), '---', ' ,'), '{', ''), '}', '')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"FilenamePattern": {
						"type": "string",
						"defaultValue": "tactical-edgewell"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Full Solution Wildcard File"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-15T15:58:39Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic JSON Cleanup')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Switch",
						"type": "Switch",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.DataWarehouseName",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Edgewell",
									"activities": [
										{
											"name": "Set Column Mapping RAW_TACTICAL_EDGEWELL_TRIMMED",
											"description": "Set Column Mapping for RAW_TACTICAL_EDGEWELL_TRIMMED",
											"type": "SetVariable",
											"dependsOn": [
												{
													"activity": "Script2",
													"dependencyConditions": [
														"Skipped"
													]
												}
											],
											"policy": {
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"variableName": "Column_Mapping_String",
												"value": "{\n\t\"type\": \"TabularTranslator\",\n\t\"mappings\": [\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"date\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"date\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_description\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_description\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_code\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_code\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_ean\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sku_ean\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"client\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"client\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sub_call\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"sub_call\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"retailer\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"retailer\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"store_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"store_id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"store_description\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"store_description\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_date\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"call_date\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t}\n\t\t}\n\t]\n}"
											}
										},
										{
											"name": "Set Column Mapping TRIMMED_QUESTIONS",
											"description": "Set Column Mapping for RAW_TACTICAL_EDGEWELL_TRIMMED_QUESTIONS",
											"type": "SetVariable",
											"dependsOn": [
												{
													"activity": "Set Column Mapping RAW_TACTICAL_EDGEWELL_TRIMMED",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"variableName": "Column Mapping String Helper",
												"value": "{\n\t\"type\": \"TabularTranslator\",\n\t\"mappings\": [\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"question\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"question\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"response\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"response\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"additional_info\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"additional_info\"\n\t\t\t}\n\t\t}\n\t]\n}"
											}
										},
										{
											"name": "Copy TRIMMED",
											"type": "Copy",
											"dependsOn": [
												{
													"activity": "Set Column Mapping RAW_TACTICAL_EDGEWELL_TRIMMED",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SnowflakeSource",
													"query": "SELECT ID,DATE,SKU_ID ,SKU_DESCRIPTION ,SKU_CODE ,SKU_EAN ,CLIENT,SUB_CALL ,RETAILER,STORE_ID ,STORE_DESCRIPTION ,CALL_DATE,CALL_ID FROM INGEST.RAW_TACTICAL_EDGEWELL",
													"exportSettings": {
														"type": "SnowflakeExportCopyCommand"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													}
												},
												"translator": {
													"value": "@variables('Column_Mapping_String')",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL_TRIMMED",
														"SchemaName": "INGEST"
													}
												}
											]
										},
										{
											"name": "Copy TRIMMED_QUESTIONS",
											"type": "Copy",
											"dependsOn": [
												{
													"activity": "Set Column Mapping TRIMMED_QUESTIONS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SnowflakeSource",
													"query": "SELECT CALL_ID, QUESTION, RESPONSE, ADDITIONAL_INFO FROM INGEST.RAW_TACTICAL_EDGEWELL",
													"exportSettings": {
														"type": "SnowflakeExportCopyCommand"
													}
												},
												"sink": {
													"type": "SnowflakeSink",
													"importSettings": {
														"type": "SnowflakeImportCopyCommand"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "ls_blob_dev_wlad",
														"type": "LinkedServiceReference"
													}
												},
												"translator": {
													"value": "@variables('Column Mapping String Helper')",
													"type": "Expression"
												}
											},
											"inputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL",
														"SchemaName": "INGEST"
													}
												}
											],
											"outputs": [
												{
													"referenceName": "TargetTable",
													"type": "DatasetReference",
													"parameters": {
														"TableName": "RAW_TACTICAL_EDGEWELL_TRIMMED_QUESTIONS",
														"SchemaName": "INGEST"
													}
												}
											]
										},
										{
											"name": "Script1",
											"type": "Script",
											"dependsOn": [],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"linkedServiceName": {
												"referenceName": "ls_sf_dev_wlad",
												"type": "LinkedServiceReference"
											},
											"typeProperties": {
												"scripts": [
													{
														"type": "Query",
														"text": "INSERT INTO INGEST.RAW_TACTICAL_EDGEWELL_TRIMMED(ID,DATE,SKU_ID ,SKU_DESCRIPTION ,SKU_CODE ,SKU_EAN ,CLIENT,SUB_CALL ,RETAILER,STORE_ID ,STORE_DESCRIPTION ,CALL_DATE,CALL_ID) \nSELECT ID,DATE,SKU_ID ,SKU_DESCRIPTION ,SKU_CODE ,SKU_EAN ,CLIENT,SUB_CALL ,RETAILER,STORE_ID ,STORE_DESCRIPTION ,CALL_DATE,CALL_ID FROM INGEST.RAW_TACTICAL_EDGEWELL\n"
													}
												],
												"scriptBlockExecutionTimeout": "02:00:00"
											}
										},
										{
											"name": "Script2",
											"type": "Script",
											"dependsOn": [
												{
													"activity": "Script1",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.12:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"linkedServiceName": {
												"referenceName": "ls_sf_dev_wlad",
												"type": "LinkedServiceReference"
											},
											"typeProperties": {
												"scripts": [
													{
														"type": "Query",
														"text": "INSERT INTO INGEST.RAW_TACTICAL_EDGEWELL_TRIMMED_QUESTIONS(CALL_ID, QUESTION, RESPONSE, ADDITIONAL_INFO) \nSELECT CALL_ID, QUESTION, RESPONSE, ADDITIONAL_INFO FROM INGEST.RAW_TACTICAL_EDGEWELL;\n"
													}
												],
												"scriptBlockExecutionTimeout": "02:00:00"
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					},
					"Slot": {
						"type": "string",
						"defaultValue": "dev"
					}
				},
				"variables": {
					"JSON_Properties": {
						"type": "Array"
					},
					"JSON_Properties_String": {
						"type": "String"
					},
					"Number_of_JSON_Properties": {
						"type": "Integer"
					},
					"Current_Property": {
						"type": "Integer"
					},
					"Column_Mapping_String": {
						"type": "String"
					},
					"Column Mapping String Helper": {
						"type": "String"
					},
					"Current_Property_Helper": {
						"type": "Integer"
					},
					"Helper_String": {
						"type": "String"
					},
					"ReadyColumnMapping": {
						"type": "String"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-16T17:14:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/TargetTable')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_sf_dev_wlad')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL Generic Load SFTP')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Get Metadata",
						"type": "GetMetadata",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "SourceSFTPJSON",
								"type": "DatasetReference",
								"parameters": {
									"Username": {
										"value": "@pipeline().parameters.Username",
										"type": "Expression"
									},
									"DataWarehouseName": {
										"value": "@pipeline().parameters.DataWarehouseName",
										"type": "Expression"
									},
									"FilePath": "/outbound/processed"
								}
							},
							"fieldList": [
								"itemName",
								"childItems"
							],
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false,
								"disableChunking": false
							},
							"formatSettings": {
								"type": "JsonReadSettings"
							}
						}
					},
					{
						"name": "Filter Filename",
						"type": "Filter",
						"dependsOn": [
							{
								"activity": "Get Metadata",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Metadata').output.childItems",
								"type": "Expression"
							},
							"condition": {
								"value": "@equals(item().type,'File')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ForEach File",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Filter Filename",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Filter Filename').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy JSON from SFTP to Azure",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "SftpReadSettings",
												"recursive": true,
												"wildcardFolderPath": "/outbound/processed",
												"wildcardFileName": "tactical-bacardi-tesco-ond-shippers-2023-02102023-25122023-20231231210008.json",
												"enablePartitionDiscovery": false,
												"disableChunking": false
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "JsonSink",
											"storeSettings": {
												"type": "AzureFileStorageWriteSettings"
											},
											"formatSettings": {
												"type": "JsonWriteSettings"
											}
										},
										"enableStaging": true,
										"stagingSettings": {
											"linkedServiceName": {
												"referenceName": "ls_blob_dev_wlad",
												"type": "LinkedServiceReference"
											}
										}
									},
									"inputs": [
										{
											"referenceName": "SourceSFTPJSON",
											"type": "DatasetReference",
											"parameters": {
												"Username": {
													"value": "@pipeline().parameters.Username",
													"type": "Expression"
												},
												"DataWarehouseName": {
													"value": "@pipeline().parameters.DataWarehouseName",
													"type": "Expression"
												},
												"FilePath": "/outbound/processed"
											}
										}
									],
									"outputs": [
										{
											"referenceName": "TargetFileJSON",
											"type": "DatasetReference",
											"parameters": {
												"DatawareHouseName": {
													"value": "@pipeline().parameters.DataWarehouseName",
													"type": "Expression"
												},
												"FileName": {
													"value": "@item().name",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "If File is Tactical",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "Copy JSON from SFTP to Azure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@startswith(item().name, 'tactical')",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "Execute Logic App",
												"type": "WebActivity",
												"dependsOn": [],
												"policy": {
													"timeout": "0.12:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"method": "POST",
													"headers": {},
													"url": "https://prod-10.uksouth.logic.azure.com:443/workflows/78818aae79a34617bb270ea5419a9eb4/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=y1bLXuZtmJMmlJy2BDHiJqHYiCf0Jh5YE3oYTjWumcU",
													"body": {
														"value": "@concat('{\n    \"FileName\": \"', item().name, '\",\n    \"DataWarehouseName\": \"', pipeline().parameters.DataWarehouseName,'\"}')",
														"type": "Expression"
													}
												}
											}
										]
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Username": {
						"type": "string",
						"defaultValue": "edgewell"
					},
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Edgewell"
					}
				},
				"annotations": [],
				"lastPublishTime": "2024-01-22T15:21:46Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceSFTPJSON')]",
				"[concat(variables('factoryId'), '/datasets/TargetFileJSON')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ETL_UUID_TEST')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Set variable1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"additionalColumns": [
									{
										"name": "ETL_UUID",
										"value": {
											"value": "HardcodedETLUUID",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "AzureFileStorageReadSettings",
									"recursive": true,
									"wildcardFolderPath": "Import/InProcess",
									"wildcardFileName": "tactical-edgewell-tesco-tactical-blitz-phase-1-2023-1112023-3112023-20231114160010.json",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"sink": {
								"type": "SqlServerSink",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false
							},
							"enableStaging": false,
							"translator": {
								"value": "@variables('columnmapping')",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "SourceFileJSON",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "SqlServerTable1",
								"type": "DatasetReference",
								"parameters": {}
							}
						]
					},
					{
						"name": "Set variable1",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "columnmapping",
							"value": "{\n\t\"type\": \"TabularTranslator\",\n\t\"mappings\": [\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"ID\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"date\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"DATE\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"SKU_ID\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_description\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"SKU_DESCRIPTION\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_code\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"SKU_CODE\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sku_ean\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"SKU_EAN\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"client\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"CLIENT\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"sub_call\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"SUB_CALL\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"retailer\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"RETAILER\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"store_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"STORE_ID\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"store_description\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"STORE_DESCRIPTION\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_date\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"CALL_DATE\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"call_id\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"CALL_ID\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"question\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"QUESTION\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"response\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"RESPONSE\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"additional_info\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"ADDITIONAL_INFO\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"source\": {\n\t\t\t\t\"name\": \"ETL_UUID\"\n\t\t\t},\n\t\t\t\"target\": {\n\t\t\t\t\"name\": \"ETL_UUID\"\n\t\t\t}\n\t\t}\n\t]\n}"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"variables": {
					"columnmapping": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-02-15T18:15:28Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceFileJSON')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Logic App Test')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Execute Logic App",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"method": "POST",
							"headers": {},
							"url": "https://prod-10.uksouth.logic.azure.com:443/workflows/78818aae79a34617bb270ea5419a9eb4/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=y1bLXuZtmJMmlJy2BDHiJqHYiCf0Jh5YE3oYTjWumcU",
							"body": {
								"value": "{\n\n\"FileName\": \"callreportstest.json\",\n\"DataWarehouseName\" : \"Edgewell\",\n\"StorageAccountName\": \"azuukssadevedgewellwlad\",\n\"FileShare\": \"stfs-sandbox-dev-wlad\",\n\"SecretName\": \"sa-file-sas-uri-edgewell-new\",\n\n}",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"FileName": {
						"type": "string",
						"defaultValue": "callreportstest.json"
					},
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Baccardi"
					}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-24T16:04:57Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/TestPipeline')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Wait1",
						"type": "Wait",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 5
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"folder": {
					"name": "Dev Leftovers"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-23T09:09:04Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/findDelimiter')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "findDelimiter",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": false,
									"wildcardFileName": "delimiter.txt",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "delimiterout",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "delimparam",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "delimparam",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {
										"delim": {
											"value": "@substring(activity('Lookup1').output.firstRow.Prop_0,11,1)",
											"type": "Expression"
										}
									},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "findDelimiter",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "findDelimiter",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source": {},
									"outputdelim": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"folder": {
					"name": "AutoCSVDebug"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/delimiterout')]",
				"[concat(variables('factoryId'), '/dataflows/delimparam')]",
				"[concat(variables('factoryId'), '/dataflows/findDelimiter')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/pipeline1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Web1",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"method": "GET",
							"headers": {},
							"url": {
								"value": "@concat('https://az-ukw-ac-dev-wlad.azconfig.io/kv/', pipeline().parameters.Edgewell_dev)",
								"type": "Expression"
							},
							"authentication": {
								"type": "MSI",
								"resource": "https://az-ukw-ac-dev-wlad.azconfig.io"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Edgewell_dev": {
						"type": "string",
						"defaultValue": "Edgewell_dev"
					}
				},
				"folder": {
					"name": "Split Into Different RGs"
				},
				"annotations": [],
				"lastPublishTime": "2024-01-22T18:29:23Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Dataset_Questions_JSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Edgewell"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": "202311250845.json",
						"container": "jsonloadtest"
					}
				},
				"schema": {
					"type": "object",
					"properties": {
						"ALERT_ID": {
							"type": "string"
						},
						"ALERT_DATE": {
							"type": "string"
						},
						"DATE": {
							"type": "string"
						},
						"SKU_CODE": {
							"type": "string"
						},
						"SKU_DESCRIPTION": {
							"type": "string"
						},
						"RETAILER": {
							"type": "string"
						},
						"STORE_ID": {
							"type": "string"
						},
						"STORE_DESCRIPTION": {
							"type": "string"
						},
						"LOST_OPP": {
							"type": "string"
						},
						"ROOTCAUSE": {
							"type": "string"
						},
						"STORE_STOCK": {
							"type": "string"
						},
						"NO_OF_DAYS_WITH_ISSUE": {
							"type": "string"
						},
						"CUMM_LOST_OPP": {
							"type": "string"
						},
						"CALL_DATE": {
							"type": "string"
						},
						"CALL_ID": {
							"type": "integer"
						},
						"Did you fix the issue?": {
							"type": "string"
						},
						"please select all actions taken to fix the issue.": {
							"type": "string"
						},
						"Did you complete any other actions for the SKU?": {
							"type": "string"
						},
						"How many individual units have been merchandised in total for this SKU?": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Dataset_Tactical_Edgewell_JSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Edgewell"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": "tactical-edgewell-tesco-tactical-blitz-phase-1-2023-1112023-3112023-20231114160010.json",
						"container": "jsonloadtest"
					}
				},
				"schema": {
					"type": "object",
					"properties": {
						"id": {
							"type": "integer"
						},
						"date": {
							"type": "string"
						},
						"sku_id": {
							"type": "integer"
						},
						"sku_description": {
							"type": "string"
						},
						"sku_code": {
							"type": "string"
						},
						"sku_ean": {
							"type": "string"
						},
						"client": {
							"type": "string"
						},
						"sub_call": {
							"type": "string"
						},
						"retailer": {
							"type": "string"
						},
						"store_id": {
							"type": "string"
						},
						"store_description": {
							"type": "string"
						},
						"call_date": {
							"type": "string"
						},
						"call_id": {
							"type": "integer"
						},
						"question": {
							"type": "string"
						},
						"response": {
							"type": "string"
						},
						"additional_info": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG_FileMover')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"StorageAccountName": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						},
						"FileShare": {
							"value": "@dataset().FileShare",
							"type": "Expression"
						},
						"KVStorageAccKey": {
							"value": "@dataset().KVStorageAccKey",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"InOrOut": {
						"type": "string"
					},
					"StorageAccountName": {
						"type": "string"
					},
					"FileShare": {
						"type": "string"
					},
					"KVStorageAccKey": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Split into Different RG"
				},
				"annotations": [],
				"type": "Binary",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"folderPath": {
							"value": "@concat('Import/',dataset().InOrOut, '/')",
							"type": "Expression"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG_SourceBlobJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"KVSasUrl": {
							"value": "@dataset().KVSasUrl",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					},
					"KVSasUrl": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Split into Different RG"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG_SourceFileJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"StorageAccountName": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						},
						"FileShare": {
							"value": "@dataset().FileShare",
							"type": "Expression"
						},
						"KVStorageAccKey": {
							"value": "@dataset().KVStorageAccKey",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"StorageAccountName": {
						"type": "string"
					},
					"FileShare": {
						"type": "string"
					},
					"KVStorageAccKey": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Split into Different RG"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation"
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG_SourceSFTPJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_sftp_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"Hostname": {
							"value": "@dataset().Hostname",
							"type": "Expression"
						},
						"Username": {
							"value": "@dataset().Username",
							"type": "Expression"
						},
						"SecretName": {
							"value": "@dataset().SecretName",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"Username": {
						"type": "string",
						"defaultValue": "clearboxretail"
					},
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Baccardi"
					},
					"FilePath": {
						"type": "string",
						"defaultValue": "/outbound/processed"
					},
					"Hostname": {
						"type": "string"
					},
					"SecretName": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Split into Different RG"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "SftpLocation",
						"folderPath": {
							"value": "@dataset().FilePath",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sftp_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG_TargetFileJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"StorageAccountName": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						},
						"FileShare": {
							"value": "@dataset().FileShare",
							"type": "Expression"
						},
						"KVStorageAccKey": {
							"value": "@dataset().KVStorageAccKey",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"DatawareHouseName": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					},
					"StorageAccountName": {
						"type": "string"
					},
					"FileShare": {
						"type": "string"
					},
					"KVStorageAccKey": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Split into Different RG"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "Import/InProcess",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DiffRG_TargetTable')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_sf_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"AccountName": {
							"value": "@dataset().AccountName",
							"type": "Expression"
						},
						"Username": {
							"value": "@dataset().Username",
							"type": "Expression"
						},
						"Database": {
							"value": "@dataset().Database",
							"type": "Expression"
						},
						"Warehouse": {
							"value": "@dataset().Warehouse",
							"type": "Expression"
						},
						"Password": {
							"value": "@dataset().Password",
							"type": "Expression"
						},
						"Role": {
							"value": "@dataset().Role",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"TableName": {
						"type": "string"
					},
					"SchemaName": {
						"type": "string"
					},
					"DatawarehouseName": {
						"type": "string",
						"defaultValue": "INTERNAL_DEV_WLAD"
					},
					"AccountName": {
						"type": "string"
					},
					"Username": {
						"type": "string"
					},
					"Database": {
						"type": "string"
					},
					"Warehouse": {
						"type": "string"
					},
					"Password": {
						"type": "string"
					},
					"Role": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Split into Different RG"
				},
				"annotations": [],
				"type": "SnowflakeTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().SchemaName",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().TableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sf_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/FileMover')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DataWarehouseName": {
						"type": "string"
					},
					"InOrOut": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Binary",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"folderPath": {
							"value": "@concat('Import/',dataset().DataWarehouseName,'/', dataset().InOrOut, '/')",
							"type": "Expression"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Generic_SourceFileCSV')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"StorageAccountName": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						},
						"FileShare": {
							"value": "@dataset().FileShare",
							"type": "Expression"
						},
						"KVStorageAccKey": {
							"value": "@dataset().KVStorageAccKey",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"StorageAccountName": {
						"type": "string",
						"defaultValue": "azuukwstdevsandboxwlad"
					},
					"FileShare": {
						"type": "string",
						"defaultValue": "stfs-sandbox-dev-wlad"
					},
					"KVStorageAccKey": {
						"type": "string",
						"defaultValue": "sa-access-key-edgewell"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "dummy.csv"
					},
					"Delimiter": {
						"type": "string"
					},
					"SkipCount": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": "Import/InProcess"
					},
					"columnDelimiter": {
						"value": "@dataset().Delimiter",
						"type": "Expression"
					},
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/KraftHeinzAPITest_Dataset')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_table_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "API Management"
				},
				"annotations": [],
				"type": "AzureTable",
				"schema": [],
				"typeProperties": {
					"tableName": "KraftHeinzAPITestNew"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_table_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/KraftHeinzAPI_CSDB_Dataset')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_csdb_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "API Management"
				},
				"annotations": [],
				"type": "CosmosDbSqlApiCollection",
				"schema": {},
				"typeProperties": {
					"collectionName": "ItemsFull"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_csdb_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/MoviesD2_fixed')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "AutoCSVDebug"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": "myfile123.csv",
						"folderPath": "output/mydataflow123partfiles",
						"container": "mycontainer"
					},
					"columnDelimiter": "",
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceBlobCSV')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileName": {
						"type": "string",
						"defaultValue": "Heinz Select App Data Sample.csv"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"container": "apikhtest"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceBlobCSVNoDelimiter')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileName": {
						"type": "string",
						"defaultValue": "Heinz Select App Data Sample.csv"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"container": "apikhtest"
					},
					"columnDelimiter": "",
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceBlobCSVNoDelimiter_split')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"KVSasUrl": {
							"value": "@dataset().KVSasUrl",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"FileName": {
						"type": "string",
						"defaultValue": "Heinz Select App Data Sample.csv"
					},
					"KVSasUrl": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"container": "staging"
					},
					"columnDelimiter": "",
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceBlobCSV_split')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"KVSasUrl": {
							"value": "@dataset().KVSasUrl",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"FileName": {
						"type": "string",
						"defaultValue": "Heinz Select App Data Sample.csv"
					},
					"KVSasUrl": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"container": "staging"
					},
					"columnDelimiter": {
						"value": "<>",
						"type": "Expression"
					},
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceBlobJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceFileCSV')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"StorageAccountName": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						},
						"FileShare": {
							"value": "@dataset().FileShare",
							"type": "Expression"
						},
						"KVStorageAccKey": {
							"value": "@dataset().KVStorageAccKey",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"StorageAccountName": {
						"type": "string",
						"defaultValue": "azuukwstdevsandboxwlad"
					},
					"FileShare": {
						"type": "string",
						"defaultValue": "stfs-sandbox-dev-wlad"
					},
					"KVStorageAccKey": {
						"type": "string",
						"defaultValue": "sa-access-key-edgewell"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "dummy.csv"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": "Import/InProcess"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceFileCSVNoDelimiter')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_split_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"StorageAccountName": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						},
						"FileShare": {
							"value": "@dataset().FileShare",
							"type": "Expression"
						},
						"KVStorageAccKey": {
							"value": "@dataset().StorageAccountName",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"StorageAccountName": {
						"type": "string",
						"defaultValue": "azuukwstdevsandboxwlad"
					},
					"FileShare": {
						"type": "string",
						"defaultValue": "stfs-sandbox-dev-wlad"
					},
					"KVStorageAccKey": {
						"type": "string",
						"defaultValue": "sa-access-key-edgewell"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "dummy.csv"
					}
				},
				"folder": {
					"name": "Auto CSV Processing"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": "Import/InProcess"
					},
					"columnDelimiter": "",
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_split_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceFileJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation"
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceSFTPJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_sftp_dev_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"Username": {
							"value": "@dataset().Username",
							"type": "Expression"
						},
						"DataWarehouseName": {
							"value": "@dataset().DataWarehouseName",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"Username": {
						"type": "string",
						"defaultValue": "clearboxretail"
					},
					"DataWarehouseName": {
						"type": "string",
						"defaultValue": "Baccardi"
					},
					"FilePath": {
						"type": "string",
						"defaultValue": "/outbound/processed"
					}
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "SftpLocation",
						"folderPath": {
							"value": "@dataset().FilePath",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sftp_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable1')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_sqls_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Edgewell"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [
					{
						"name": "ID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "DATE",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "SKU_ID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "SKU_DESCRIPTION",
						"type": "varchar"
					},
					{
						"name": "SKU_CODE",
						"type": "int",
						"precision": 10
					},
					{
						"name": "SKU_EAN",
						"type": "int",
						"precision": 10
					},
					{
						"name": "CLIENT",
						"type": "varchar"
					},
					{
						"name": "SUB_CALL",
						"type": "varchar"
					},
					{
						"name": "RETAILER",
						"type": "varchar"
					},
					{
						"name": "STORE_ID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "STORE_DESCRIPTION",
						"type": "varchar"
					},
					{
						"name": "CALL_DATE",
						"type": "date"
					},
					{
						"name": "CALL_ID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "QUESTION",
						"type": "varchar"
					},
					{
						"name": "RESPONSE",
						"type": "varchar"
					},
					{
						"name": "ADDITIONAL_INFO",
						"type": "varchar"
					},
					{
						"name": "ETL_UUID",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "INGEST",
					"table": "RAW_TACTICAL_EDGEWELL_WITHETLUUID"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sqls_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/TargetFileJSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_file_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DatawareHouseName": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureFileStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@concat('Import/',dataset().DatawareHouseName,'/InProcess/')",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_file_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/TargetTable')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_sf_dev_wlad",
					"type": "LinkedServiceReference",
					"parameters": {
						"DatawarehouseName": {
							"value": "@dataset().DatawarehouseName",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"TableName": {
						"type": "string"
					},
					"SchemaName": {
						"type": "string"
					},
					"DatawarehouseName": {
						"type": "string",
						"defaultValue": "INTERNAL_DEV_WLAD"
					}
				},
				"annotations": [],
				"type": "SnowflakeTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().SchemaName",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().TableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_sf_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/delimiterout')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "AutoCSVDebug"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"folderPath": "output/mydataflow123partfiles",
						"container": "mycontainer"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/dynadelim')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"delim": {
						"type": "string"
					}
				},
				"folder": {
					"name": "AutoCSVDebug"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": "moviesDB.csv",
						"folderPath": "SampleData",
						"container": "mycontainer"
					},
					"columnDelimiter": {
						"value": "@dataset().delim",
						"type": "Expression"
					},
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/folderout')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ls_blob_dev_wlad",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "AutoCSVDebug"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"folderPath": "output/mydataflow123partfiles",
						"container": "mycontainer"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/kv_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureKeyVault",
				"typeProperties": {
					"baseUrl": "[parameters('kv_dev_wlad_properties_typeProperties_baseUrl')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_blob_dev_split_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"KVSasUrl": {
						"type": "string",
						"defaultValue": "sa-blob-sas-uri-edgewell"
					}
				},
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"sasUri": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "kv_dev_wlad",
							"type": "LinkedServiceReference"
						},
						"secretName": {
							"value": "[parameters('ls_blob_dev_split_wlad_properties_typeProperties_sasUri_secretName')]",
							"type": "Expression"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/kv_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_blob_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "A linked service to Wlad's dev storage account for testing purposes",
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"sasUri": "[parameters('ls_blob_dev_wlad_sasUri')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_csdb_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "CosmosDb",
				"typeProperties": {
					"connectionString": "[parameters('ls_csdb_dev_wlad_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_file_dev_split_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"StorageAccountName": {
						"type": "string",
						"defaultValue": "azuukwstdevsandboxwlad"
					},
					"FileShare": {
						"type": "string",
						"defaultValue": "stfs-sandbox-dev-wlad"
					},
					"KVStorageAccKey": {
						"type": "string",
						"defaultValue": "sa-access-key-edgewell"
					}
				},
				"annotations": [],
				"type": "AzureFileStorage",
				"typeProperties": {
					"connectionString": "[parameters('ls_file_dev_split_wlad_connectionString')]",
					"accountKey": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "kv_dev_wlad",
							"type": "LinkedServiceReference"
						},
						"secretName": {
							"value": "@linkedService().KVStorageAccKey",
							"type": "Expression"
						}
					},
					"fileShare": "@{linkedService().FileShare}"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/kv_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_file_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "A linked service to Wlad's file share for dev purposes",
				"annotations": [],
				"type": "AzureFileStorage",
				"typeProperties": {
					"connectionString": "[parameters('ls_file_dev_wlad_connectionString')]",
					"fileShare": "stfs-sandbox-dev-wlad"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_sf_dev_split_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"AccountName": {
						"type": "string",
						"defaultValue": "clearboxretail-demo"
					},
					"Username": {
						"type": "string",
						"defaultValue": "wbielski"
					},
					"Database": {
						"type": "string",
						"defaultValue": "INTERNAL_DEV_WLAD"
					},
					"Warehouse": {
						"type": "string",
						"defaultValue": "CLEARBOX_DEV_LOAD"
					},
					"Password": {
						"type": "string",
						"defaultValue": "sf-edgewell-password"
					},
					"Role": {
						"type": "string",
						"defaultValue": "LOAD_SERVICE"
					}
				},
				"annotations": [],
				"type": "Snowflake",
				"typeProperties": {
					"authenticationType": "Basic",
					"connectionString": "[parameters('ls_sf_dev_split_wlad_connectionString')]",
					"password": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "kv_dev_wlad",
							"type": "LinkedServiceReference"
						},
						"secretName": {
							"value": "@linkedService().Password",
							"type": "Expression"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/kv_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_sf_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Linked Service to INTERNAL_DEV_WLAD database",
				"parameters": {
					"DatawarehouseName": {
						"type": "string",
						"defaultValue": "INTERNAL_DEV_WLAD"
					}
				},
				"annotations": [],
				"type": "Snowflake",
				"typeProperties": {
					"authenticationType": "Basic",
					"connectionString": "[parameters('ls_sf_dev_wlad_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_sftp_dev_split_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"Hostname": {
						"type": "string"
					},
					"Username": {
						"type": "string"
					},
					"SecretName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Sftp",
				"typeProperties": {
					"host": "[parameters('ls_sftp_dev_split_wlad_properties_typeProperties_host')]",
					"port": 22,
					"skipHostKeyValidation": true,
					"authenticationType": "SshPublicKey",
					"userName": "[parameters('ls_sftp_dev_split_wlad_properties_typeProperties_userName')]",
					"privateKeyContent": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "kv_dev_wlad",
							"type": "LinkedServiceReference"
						},
						"secretName": {
							"value": "@linkedService().SecretName",
							"type": "Expression"
						}
					},
					"passPhrase": {
						"type": "SecureString",
						"value": "[parameters('ls_sftp_dev_split_wlad_passPhrase')]"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/kv_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_sftp_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"Username": {
						"type": "string",
						"defaultValue": "clearboxretail"
					},
					"DataWarehouseName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Sftp",
				"typeProperties": {
					"host": "[parameters('ls_sftp_dev_wlad_properties_typeProperties_host')]",
					"port": 22,
					"skipHostKeyValidation": true,
					"authenticationType": "SshPublicKey",
					"userName": "[parameters('ls_sftp_dev_wlad_properties_typeProperties_userName')]",
					"privateKeyContent": {
						"type": "SecureString",
						"value": "[parameters('ls_sftp_dev_wlad_privateKeyContent')]"
					},
					"passPhrase": {
						"type": "SecureString",
						"value": "[parameters('ls_sftp_dev_wlad_passPhrase')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_sqls_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('ls_sqls_wlad_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ls_table_dev_wlad')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureTableStorage",
				"typeProperties": {
					"sasUri": "[parameters('ls_table_dev_wlad_sasUri')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/delimparam')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "AutoCSVDebug"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "dynadelim",
								"type": "DatasetReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "folderout",
								"type": "DatasetReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [],
					"script": "source(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> source1\nsource1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tpartitionFileNames:['delimfinal.txt'],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('hash', 1)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/dynadelim')]",
				"[concat(variables('factoryId'), '/datasets/folderout')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/findCSVDelimiter')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "SourceBlobCSVNoDelimiter_split",
								"type": "DatasetReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "SourceBlobCSVNoDelimiter_split",
								"type": "DatasetReference"
							},
							"name": "sink1",
							"rejectedDataLinkedService": {
								"referenceName": "ls_blob_dev_wlad",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [
						{
							"name": "surrogateKey1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "derivedColumn2"
						}
					],
					"scriptLines": [
						"parameters{",
						"     fileName as string",
						"}",
						"source(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     skipLines: 5,",
						"     wildcardPaths:[(toString($fileName))]) ~> source1",
						"derivedColumn2 keyGenerate(output(rownum as long),",
						"     startAt: 1L,",
						"     stepValue: 1L) ~> surrogateKey1",
						"surrogateKey1 filter(rownum == 5) ~> filter1",
						"filter1 derive(delimeter = 'Delimiter:'+toString(regexExtract({_col0_},'([!$`~%^,|\\t|;|,])',1))) ~> derivedColumn1",
						"source1 derive({_col0_} = toString(byName('_col0_'))) ~> derivedColumn2",
						"derivedColumn1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     partitionFileNames:[(toString(concat('delimiter_', replace($fileName, '.csv', '.txt'))))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     quoteAll: true,",
						"     mapColumn(",
						"          delimeter",
						"     ),",
						"     partitionBy('hash', 1)) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceBlobCSVNoDelimiter_split')]",
				"[concat(variables('factoryId'), '/linkedServices/ls_blob_dev_wlad')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/findCSVHeaders')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "SourceBlobCSVNoDelimiter_split",
								"type": "DatasetReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "SourceBlobCSVNoDelimiter_split",
								"type": "DatasetReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "surrogateKey1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"parameters{",
						"     fileName as string",
						"}",
						"source(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> source1",
						"source1 keyGenerate(output(rownum as long),",
						"     startAt: 1L,",
						"     stepValue: 1L) ~> surrogateKey1",
						"surrogateKey1 derive(datalines = iif(startsWith(toString(byPosition(1)), '\"')\r",
						", iif(!isNull(toInteger(substring(toString(byPosition(1)),2,1))),toInteger(rownum),toInteger(0))\r",
						", (iif(!isNull(toInteger(left(toString(byPosition(1)),1))),toInteger(rownum),toInteger(0)))\r",
						")) ~> derivedColumn1",
						"derivedColumn1 aggregate(column1 = minIf(datalines!=0,datalines)) ~> aggregate1",
						"aggregate1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     partitionFileNames:[(toString(concat('headers_', replace($fileName, '.csv', '.txt'))))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     quoteAll: true,",
						"     partitionBy('hash', 1)) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SourceBlobCSVNoDelimiter_split')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/findDelimiter')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "AutoCSVDebug"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "MoviesD2_fixed",
								"type": "DatasetReference"
							},
							"name": "source"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "delimiterout",
								"type": "DatasetReference"
							},
							"name": "outputdelim"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "JustHeader"
						},
						{
							"name": "NameSingleCol",
							"description": "Creates an explicit mapping for each drifted column"
						},
						{
							"name": "NumberEachRow"
						}
					],
					"script": "source(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> source\nJustHeader derive(delimiter = 'Delimiter:,'+toString(regexExtract({_col0_},'([!$`~%^,|\\t])',1))) ~> DerivedColumn1\nNumberEachRow filter(rownum == 1) ~> JustHeader\nsource derive({_col0_} = toString(byName('_col0_'))) ~> NameSingleCol\nNameSingleCol keyGenerate(output(rownum as long),\n\tstartAt: 1L,\n\tstepValue: 1L) ~> NumberEachRow\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tpartitionFileNames:['delimiter.txt'],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tquoteAll: true,\n\tmapColumn(\n\t\tdelimiter\n\t),\n\tpartitionBy('hash', 1)) ~> outputdelim"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/MoviesD2_fixed')]",
				"[concat(variables('factoryId'), '/datasets/delimiterout')]"
			]
		}
	]
}